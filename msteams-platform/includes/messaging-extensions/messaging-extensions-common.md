## <a name="add-a-messaging-extension-to-your-app"></a><span data-ttu-id="8edfd-101">向您的应用程序添加消息扩展插件</span><span class="sxs-lookup"><span data-stu-id="8edfd-101">Add a messaging extension to your app</span></span>

<span data-ttu-id="8edfd-102">邮件扩展是云托管的服务，它可侦听用户请求并使用结构化数据（如[卡片](~/task-modules-and-cards/what-are-cards.md)）进行响应。</span><span class="sxs-lookup"><span data-stu-id="8edfd-102">A messaging extension is a cloud-hosted service that listens to user requests and responds with structured data, such as a [card](~/task-modules-and-cards/what-are-cards.md).</span></span> <span data-ttu-id="8edfd-103">您可以通过 Bot 框架`Activity`对象将服务与 Microsoft 团队集成。</span><span class="sxs-lookup"><span data-stu-id="8edfd-103">You integrate your service with Microsoft Teams via Bot Framework `Activity` objects.</span></span> <span data-ttu-id="8edfd-104">用于机器人生成器 SDK 的 .NET 和 node.js 扩展可帮助您向您的应用程序添加消息扩展功能。</span><span class="sxs-lookup"><span data-stu-id="8edfd-104">Our .NET and Node.js extensions for the Bot Builder SDK can help you add messaging extension functionality to your app.</span></span>

![邮件传递扩展的邮件流关系图](~/assets/images/compose-extensions/ceflow.png)

### <a name="register-in-the-bot-framework"></a><span data-ttu-id="8edfd-106">在 Bot 框架中注册</span><span class="sxs-lookup"><span data-stu-id="8edfd-106">Register in the Bot Framework</span></span>

<span data-ttu-id="8edfd-107">如果尚未执行此操作，则必须先在 Microsoft Bot 框架中注册一个 bot。</span><span class="sxs-lookup"><span data-stu-id="8edfd-107">If you haven’t done so already, you must first register a bot with the Microsoft Bot Framework.</span></span> <span data-ttu-id="8edfd-108">你的 bot 的 Microsoft app ID 和回叫终结点（定义在这里）将在你的邮件扩展中用于接收和响应用户请求。</span><span class="sxs-lookup"><span data-stu-id="8edfd-108">The Microsoft app ID and callback endpoints for your bot, as defined there, will be used in your messaging extension to receive and respond to user requests.</span></span> <span data-ttu-id="8edfd-109">请记住为你的机器人启用 Microsoft 团队频道。</span><span class="sxs-lookup"><span data-stu-id="8edfd-109">Remember to enable the Microsoft Teams channel for your bot.</span></span>

<span data-ttu-id="8edfd-110">记录你的 bot 应用 ID 和应用密码，将需要在你的应用程序清单中提供应用程序 ID。</span><span class="sxs-lookup"><span data-stu-id="8edfd-110">Record your bot app ID and app password, you will need to supply the app ID in your app manifest.</span></span>

### <a name="update-your-app-manifest"></a><span data-ttu-id="8edfd-111">更新应用程序清单</span><span class="sxs-lookup"><span data-stu-id="8edfd-111">Update your app manifest</span></span>

<span data-ttu-id="8edfd-112">与 bot 和选项卡一样，您可以更新应用程序的[清单](~/resources/schema/manifest-schema.md#composeextensions)以包含邮件扩展属性。</span><span class="sxs-lookup"><span data-stu-id="8edfd-112">As with bots and tabs, you update the [manifest](~/resources/schema/manifest-schema.md#composeextensions) of your app to include the messaging extension properties.</span></span> <span data-ttu-id="8edfd-113">这些属性控制您的邮件扩展在 Microsoft 团队客户端中的显示和行为。</span><span class="sxs-lookup"><span data-stu-id="8edfd-113">These properties govern how your messaging extension appears and behaves in the Microsoft Teams client.</span></span> <span data-ttu-id="8edfd-114">从清单的1.0 版开始，支持邮件扩展。</span><span class="sxs-lookup"><span data-stu-id="8edfd-114">Messaging extensions are supported beginning with v1.0 of the manifest.</span></span>

#### <a name="declare-your-messaging-extension"></a><span data-ttu-id="8edfd-115">声明消息扩展</span><span class="sxs-lookup"><span data-stu-id="8edfd-115">Declare your messaging extension</span></span>

<span data-ttu-id="8edfd-116">若要添加消息扩展，请在清单中将新的顶级 JSON 结构包含在`composeExtensions`属性中。</span><span class="sxs-lookup"><span data-stu-id="8edfd-116">To add a messaging extension, include a new top-level JSON structure in your manifest with the `composeExtensions` property.</span></span> <span data-ttu-id="8edfd-117">目前，您仅限于为您的应用程序创建一个邮件扩展插件。</span><span class="sxs-lookup"><span data-stu-id="8edfd-117">Currently, you are limited to creating a single messaging extension for your app.</span></span>

> [!NOTE]
> <span data-ttu-id="8edfd-118">清单将邮件传递扩展作为`composeExtensions`引用。</span><span class="sxs-lookup"><span data-stu-id="8edfd-118">The manifest refers to messaging extensions as `composeExtensions`.</span></span> <span data-ttu-id="8edfd-119">这是为了保持向后兼容性。</span><span class="sxs-lookup"><span data-stu-id="8edfd-119">This is to maintain backward compatibility.</span></span>

<span data-ttu-id="8edfd-120">扩展定义是一个具有以下结构的对象：</span><span class="sxs-lookup"><span data-stu-id="8edfd-120">The extension definition is an object that has the following structure:</span></span>

| <span data-ttu-id="8edfd-121">属性名称</span><span class="sxs-lookup"><span data-stu-id="8edfd-121">Property name</span></span> | <span data-ttu-id="8edfd-122">用途</span><span class="sxs-lookup"><span data-stu-id="8edfd-122">Purpose</span></span> | <span data-ttu-id="8edfd-123">是否必需？</span><span class="sxs-lookup"><span data-stu-id="8edfd-123">Required?</span></span> |
|---|---|---|
| `botId` | <span data-ttu-id="8edfd-124">与 Bot 框架一起注册的 bot 的唯一 Microsoft 应用 ID。</span><span class="sxs-lookup"><span data-stu-id="8edfd-124">The unique Microsoft app ID for the bot as registered with the Bot Framework.</span></span> <span data-ttu-id="8edfd-125">通常应与整个团队应用程序的 ID 相同。</span><span class="sxs-lookup"><span data-stu-id="8edfd-125">This should typically be the same as the ID for your overall Teams app.</span></span> | <span data-ttu-id="8edfd-126">是</span><span class="sxs-lookup"><span data-stu-id="8edfd-126">Yes</span></span> |
| `scopes` | <span data-ttu-id="8edfd-127">数组声明此扩展是否可以添加到`personal`或`team`范围（或两者）。</span><span class="sxs-lookup"><span data-stu-id="8edfd-127">Array declaring whether this extension can be added to `personal` or `team` scopes (or both).</span></span> | <span data-ttu-id="8edfd-128">是</span><span class="sxs-lookup"><span data-stu-id="8edfd-128">Yes</span></span> |
| `canUpdateConfiguration` | <span data-ttu-id="8edfd-129">启用 "**设置**" 菜单项。</span><span class="sxs-lookup"><span data-stu-id="8edfd-129">Enables **Settings** menu item.</span></span> | <span data-ttu-id="8edfd-130">否</span><span class="sxs-lookup"><span data-stu-id="8edfd-130">No</span></span> |
| `commands` | <span data-ttu-id="8edfd-131">此消息扩展支持的命令数组。</span><span class="sxs-lookup"><span data-stu-id="8edfd-131">Array of commands that this messaging extension supports.</span></span> <span data-ttu-id="8edfd-132">限制为10个命令。</span><span class="sxs-lookup"><span data-stu-id="8edfd-132">You are limited to 10 commands.</span></span> | <span data-ttu-id="8edfd-133">是</span><span class="sxs-lookup"><span data-stu-id="8edfd-133">Yes</span></span> |

#### <a name="define-commands"></a><span data-ttu-id="8edfd-134">定义命令</span><span class="sxs-lookup"><span data-stu-id="8edfd-134">Define commands</span></span>

<span data-ttu-id="8edfd-135">您的邮件扩展应声明一个命令，当用户从 "撰写" 框中的 "**更多选项**（**&#8943;**）" 按钮中选择您的应用程序时，将显示该命令。</span><span class="sxs-lookup"><span data-stu-id="8edfd-135">Your messaging extension should declare one command, which appears when the user selects your app from the **More options** (**&#8943;**) button in the compose box.</span></span>

![团队中的邮件扩展列表的屏幕截图](~/assets/images/compose-extensions/compose-extension-list.png)

<span data-ttu-id="8edfd-137">在应用程序清单中，您的命令项是一个具有以下结构的对象：</span><span class="sxs-lookup"><span data-stu-id="8edfd-137">In the app manifest, your command item is an object with the following structure:</span></span>

| <span data-ttu-id="8edfd-138">属性名称</span><span class="sxs-lookup"><span data-stu-id="8edfd-138">Property name</span></span> | <span data-ttu-id="8edfd-139">用途</span><span class="sxs-lookup"><span data-stu-id="8edfd-139">Purpose</span></span> | <span data-ttu-id="8edfd-140">是否必需？</span><span class="sxs-lookup"><span data-stu-id="8edfd-140">Required?</span></span> | <span data-ttu-id="8edfd-141">最低清单版本</span><span class="sxs-lookup"><span data-stu-id="8edfd-141">Minimum manifest version</span></span> |
|---|---|---|---|
| `id` | <span data-ttu-id="8edfd-142">您分配给此命令的唯一 ID。</span><span class="sxs-lookup"><span data-stu-id="8edfd-142">Unique ID that you assign to this command.</span></span> <span data-ttu-id="8edfd-143">用户请求将包括此 ID。</span><span class="sxs-lookup"><span data-stu-id="8edfd-143">The user request will include this ID.</span></span> | <span data-ttu-id="8edfd-144">是</span><span class="sxs-lookup"><span data-stu-id="8edfd-144">Yes</span></span> | <span data-ttu-id="8edfd-145">1.0</span><span class="sxs-lookup"><span data-stu-id="8edfd-145">1.0</span></span> |
| `title` | <span data-ttu-id="8edfd-146">命令名称。</span><span class="sxs-lookup"><span data-stu-id="8edfd-146">Command name.</span></span> <span data-ttu-id="8edfd-147">此值显示在 UI 中。</span><span class="sxs-lookup"><span data-stu-id="8edfd-147">This value appears in the UI.</span></span> | <span data-ttu-id="8edfd-148">是</span><span class="sxs-lookup"><span data-stu-id="8edfd-148">Yes</span></span> | <span data-ttu-id="8edfd-149">1.0</span><span class="sxs-lookup"><span data-stu-id="8edfd-149">1.0</span></span> |
| `description` | <span data-ttu-id="8edfd-150">指示此命令执行的操作的帮助文本。</span><span class="sxs-lookup"><span data-stu-id="8edfd-150">Help text indicating what this command does.</span></span> <span data-ttu-id="8edfd-151">此值显示在 UI 中。</span><span class="sxs-lookup"><span data-stu-id="8edfd-151">This value appears in the UI.</span></span> | <span data-ttu-id="8edfd-152">是</span><span class="sxs-lookup"><span data-stu-id="8edfd-152">Yes</span></span> | <span data-ttu-id="8edfd-153">1.0</span><span class="sxs-lookup"><span data-stu-id="8edfd-153">1.0</span></span> |
| `type` | <span data-ttu-id="8edfd-154">设置命令的类型。</span><span class="sxs-lookup"><span data-stu-id="8edfd-154">Set the type of command.</span></span> <span data-ttu-id="8edfd-155">可取值包括 `query` 和 `action`。</span><span class="sxs-lookup"><span data-stu-id="8edfd-155">Possible values include `query` and `action`.</span></span> <span data-ttu-id="8edfd-156">如果不存在，则默认值设置为`query`</span><span class="sxs-lookup"><span data-stu-id="8edfd-156">If not present the default value is set to `query`</span></span> | <span data-ttu-id="8edfd-157">否</span><span class="sxs-lookup"><span data-stu-id="8edfd-157">No</span></span> | <span data-ttu-id="8edfd-158">1.4</span><span class="sxs-lookup"><span data-stu-id="8edfd-158">1.4</span></span> |
| `initialRun` | <span data-ttu-id="8edfd-159">与命令一起使用的`query`可选参数。</span><span class="sxs-lookup"><span data-stu-id="8edfd-159">Optional parameter, used with `query` commands.</span></span> <span data-ttu-id="8edfd-160">如果设置为**true**，则指示应在用户在 UI 中选择此命令后立即执行此命令。</span><span class="sxs-lookup"><span data-stu-id="8edfd-160">If set to **true**, indicates this command should be executed as soon as the user chooses this command in the UI.</span></span> | <span data-ttu-id="8edfd-161">否</span><span class="sxs-lookup"><span data-stu-id="8edfd-161">No</span></span> | <span data-ttu-id="8edfd-162">1.0</span><span class="sxs-lookup"><span data-stu-id="8edfd-162">1.0</span></span> |
| `fetchTask` | <span data-ttu-id="8edfd-163">与命令一起使用的`action`可选参数。</span><span class="sxs-lookup"><span data-stu-id="8edfd-163">Optional parameter, used with `action` commands.</span></span> <span data-ttu-id="8edfd-164">设置为**true**以提取在[任务模块](~/task-modules-and-cards/what-are-task-modules.md)中显示的自适应卡片或 web url。</span><span class="sxs-lookup"><span data-stu-id="8edfd-164">Set to **true** to fetch the adaptive card or web url to display within the [task module](~/task-modules-and-cards/what-are-task-modules.md).</span></span> <span data-ttu-id="8edfd-165">当`action`命令的输入是动态的，而不是一组静态参数时，将使用此参数。</span><span class="sxs-lookup"><span data-stu-id="8edfd-165">This is used when the inputs to the `action` command is dynamic as opposed to a static set of parameters.</span></span> <span data-ttu-id="8edfd-166">请注意，如果设置为**true** ，则忽略命令的静态参数列表</span><span class="sxs-lookup"><span data-stu-id="8edfd-166">Note that the if set to **true** the static parameter list for the command is ignored</span></span> | <span data-ttu-id="8edfd-167">否</span><span class="sxs-lookup"><span data-stu-id="8edfd-167">No</span></span> | <span data-ttu-id="8edfd-168">1.4</span><span class="sxs-lookup"><span data-stu-id="8edfd-168">1.4</span></span> |
| `parameters` | <span data-ttu-id="8edfd-169">命令的参数的静态列表。</span><span class="sxs-lookup"><span data-stu-id="8edfd-169">Static list of parameters for the command.</span></span> | <span data-ttu-id="8edfd-170">是</span><span class="sxs-lookup"><span data-stu-id="8edfd-170">Yes</span></span> | <span data-ttu-id="8edfd-171">1.0</span><span class="sxs-lookup"><span data-stu-id="8edfd-171">1.0</span></span> |
| `parameter.name` | <span data-ttu-id="8edfd-172">参数的名称。</span><span class="sxs-lookup"><span data-stu-id="8edfd-172">The name of the parameter.</span></span> <span data-ttu-id="8edfd-173">此项将发送到用户请求中的服务。</span><span class="sxs-lookup"><span data-stu-id="8edfd-173">This is sent to your service in the user request.</span></span> | <span data-ttu-id="8edfd-174">是</span><span class="sxs-lookup"><span data-stu-id="8edfd-174">Yes</span></span> | <span data-ttu-id="8edfd-175">1.0</span><span class="sxs-lookup"><span data-stu-id="8edfd-175">1.0</span></span> |
| `parameter.description` | <span data-ttu-id="8edfd-176">描述了此参数的用途或应提供的值的示例。</span><span class="sxs-lookup"><span data-stu-id="8edfd-176">Describes this parameter’s purposes or example of the value that should be provided.</span></span> <span data-ttu-id="8edfd-177">此值显示在 UI 中。</span><span class="sxs-lookup"><span data-stu-id="8edfd-177">This value appears in the UI.</span></span> | <span data-ttu-id="8edfd-178">是</span><span class="sxs-lookup"><span data-stu-id="8edfd-178">Yes</span></span> | <span data-ttu-id="8edfd-179">1.0</span><span class="sxs-lookup"><span data-stu-id="8edfd-179">1.0</span></span> |
| `parameter.title` | <span data-ttu-id="8edfd-180">短用户友好参数标题或标签。</span><span class="sxs-lookup"><span data-stu-id="8edfd-180">Short user-friendly parameter title or label.</span></span> | <span data-ttu-id="8edfd-181">是</span><span class="sxs-lookup"><span data-stu-id="8edfd-181">Yes</span></span> | <span data-ttu-id="8edfd-182">1.0</span><span class="sxs-lookup"><span data-stu-id="8edfd-182">1.0</span></span> |
| `parameter.inputType` | <span data-ttu-id="8edfd-183">设置为所需的输入类型。</span><span class="sxs-lookup"><span data-stu-id="8edfd-183">Set to the type of input required.</span></span> <span data-ttu-id="8edfd-184">可能的值`text`包括`textarea`、 `number`、 `date`、 `time`、 `toggle`、。</span><span class="sxs-lookup"><span data-stu-id="8edfd-184">Possible values include `text`, `textarea`, `number`, `date`, `time`, `toggle`.</span></span> <span data-ttu-id="8edfd-185">默认值设置为`text`</span><span class="sxs-lookup"><span data-stu-id="8edfd-185">Default is set to `text`</span></span> | <span data-ttu-id="8edfd-186">否</span><span class="sxs-lookup"><span data-stu-id="8edfd-186">No</span></span> | <span data-ttu-id="8edfd-187">1.4</span><span class="sxs-lookup"><span data-stu-id="8edfd-187">1.4</span></span> |
| `context` | <span data-ttu-id="8edfd-188">用于定义消息操作在中可用的上下文的可选值数组。</span><span class="sxs-lookup"><span data-stu-id="8edfd-188">Optional array of values that defines the context the message action is available in.</span></span> <span data-ttu-id="8edfd-189">可能的值`message`为`compose`、或`commandBox`。</span><span class="sxs-lookup"><span data-stu-id="8edfd-189">Possible values are `message`, `compose`, or `commandBox`.</span></span> <span data-ttu-id="8edfd-190">默认值为 `["compose", "commandBox"]`。</span><span class="sxs-lookup"><span data-stu-id="8edfd-190">Default is `["compose", "commandBox"]`.</span></span> | <span data-ttu-id="8edfd-191">否</span><span class="sxs-lookup"><span data-stu-id="8edfd-191">No</span></span> | <span data-ttu-id="8edfd-192">1.5</span><span class="sxs-lookup"><span data-stu-id="8edfd-192">1.5</span></span> |

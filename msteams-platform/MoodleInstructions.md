---
title: 安装与 Microsoft 团队的 Moodle 集成
description: 如何为 Microsoft 团队安装和配置 Moodle 集成应用程序
keywords: 团队 Moodle 应用集成插件
ms.date: 01/31/2019
ms.openlocfilehash: 012d6e9c979386e892b5a47b7655208eca95e11a
ms.sourcegitcommit: 4329a94918263c85d6c65ff401f571556b80307b
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/01/2020
ms.locfileid: "41672966"
---
# <a name="installing-the-moodle-integration-with-microsoft-teams"></a><span data-ttu-id="329c2-104">安装与 Microsoft 团队的 Moodle 集成</span><span class="sxs-lookup"><span data-stu-id="329c2-104">Installing the Moodle integration with Microsoft Teams</span></span>

> [!VIDEO https://www.youtube.com/embed/OHlPt22nKoE]

<span data-ttu-id="329c2-105">[Moodle](https://moodle.org/)是世界上最受欢迎和开放源代码的学习管理系统（LMS）现已与 Microsoft 团队集成！</span><span class="sxs-lookup"><span data-stu-id="329c2-105">[Moodle](https://moodle.org/), the most popular and open-source Learning Management System (LMS) in the world, is now integrated with Microsoft Teams!</span></span> <span data-ttu-id="329c2-106">此集成可帮助教师和教师在 Moodle 课程中进行协作，询问有关其成绩和工作分配的问题，并在团队中及时更新通知！</span><span class="sxs-lookup"><span data-stu-id="329c2-106">This integration helps educators and teachers collaborate around Moodle courses, ask questions about their grades and assignments and stay updated with notifications -- right within Teams!</span></span>

<span data-ttu-id="329c2-107">为了帮助 IT 管理员轻松设置这种集成，我们已使用以下功能更新了我们的开放源代码 Office 365 Moodle 插件：</span><span class="sxs-lookup"><span data-stu-id="329c2-107">To help IT admins easily set this integration up, we have updated our open-source Office 365 Moodle Plugin with the following capabilities:</span></span>

* <span data-ttu-id="329c2-108">使用 Azure AD 自动注册 Moodle 服务器。</span><span class="sxs-lookup"><span data-stu-id="329c2-108">Auto-registration of your Moodle server with Azure AD.</span></span>
* <span data-ttu-id="329c2-109">将 Moodle 助手 bot 的一次单击部署到 Azure。</span><span class="sxs-lookup"><span data-stu-id="329c2-109">One-click deployment of your Moodle Assistant bot to Azure.</span></span>
* <span data-ttu-id="329c2-110">自动预配团队和自动同步团队注册的所有或选择 Moodle 课程。</span><span class="sxs-lookup"><span data-stu-id="329c2-110">Auto-provisioning of teams and auto-synchronization of team enrollments for all or select Moodle courses.</span></span>
* <span data-ttu-id="329c2-111">将 Moodle 选项卡和 Moodle 助手 bot 自动安装到每个已同步的团队中。</span><span class="sxs-lookup"><span data-stu-id="329c2-111">Auto-installation of the Moodle tab and the Moodle Assistant bot into each synchronized team.</span></span> <span data-ttu-id="329c2-112">（即将推出）</span><span class="sxs-lookup"><span data-stu-id="329c2-112">(Coming soon)</span></span>
* <span data-ttu-id="329c2-113">单击一次，将 Moodle 应用发布到私有团队应用商店中。</span><span class="sxs-lookup"><span data-stu-id="329c2-113">One-click publishing of the Moodle app into your private Teams App Store.</span></span> <span data-ttu-id="329c2-114">（即将推出）</span><span class="sxs-lookup"><span data-stu-id="329c2-114">(Coming soon)</span></span>

<span data-ttu-id="329c2-115">若要了解此集成提供的功能的详细信息，请转到[此处](https://education.microsoft.com/courses-and-resources/resources/microsoft-teams-moodle)。</span><span class="sxs-lookup"><span data-stu-id="329c2-115">To learn more about the functionality this integration provides, go [here](https://education.microsoft.com/courses-and-resources/resources/microsoft-teams-moodle).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="329c2-116">先决条件</span><span class="sxs-lookup"><span data-stu-id="329c2-116">Prerequisites</span></span>

<span data-ttu-id="329c2-117">若要安装和配置此应用程序，你将需要：</span><span class="sxs-lookup"><span data-stu-id="329c2-117">In order to install and configure this application you'll need:</span></span>

1. <span data-ttu-id="329c2-118">Moodle 管理员凭据</span><span class="sxs-lookup"><span data-stu-id="329c2-118">Moodle administrator credentials</span></span>
2. <span data-ttu-id="329c2-119">Azure AD 管理员凭据</span><span class="sxs-lookup"><span data-stu-id="329c2-119">Azure AD administrator credentials</span></span>
3. <span data-ttu-id="329c2-120">Azure 订阅可以在中创建新资源</span><span class="sxs-lookup"><span data-stu-id="329c2-120">An Azure subscription you can create new resources in</span></span>

## <a name="step-1-install-the-office-365-moodle-plugin"></a><span data-ttu-id="329c2-121">步骤1：安装 Office 365 Moodle 插件</span><span class="sxs-lookup"><span data-stu-id="329c2-121">Step 1: Install the Office 365 Moodle Plugin</span></span>

> [!VIDEO https://www.youtube.com/embed/SETEC5nzMgk]

<span data-ttu-id="329c2-122">Microsoft 团队中的 Moodle 集成由开放源[Office 365 Moodle 插件集](https://github.com/Microsoft/o365-moodle)提供支持。</span><span class="sxs-lookup"><span data-stu-id="329c2-122">The Moodle integration in Microsoft Teams is powered by the open source [Office 365 Moodle plugin set](https://github.com/Microsoft/o365-moodle).</span></span> <span data-ttu-id="329c2-123">若要在 Moodle 服务器上安装插件，请执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="329c2-123">To install the plugin in your Moodle server:</span></span>

1. <span data-ttu-id="329c2-124">首先，下载[Office 365 插件集](https://moodle.org/plugins/pluginversions.php?plugin=local_o365)并将其保存到本地计算机。</span><span class="sxs-lookup"><span data-stu-id="329c2-124">First, download the [Office 365 plugin set](https://moodle.org/plugins/pluginversions.php?plugin=local_o365) and save it to your local computer.</span></span> <span data-ttu-id="329c2-125">您需要使用版本3.5 或更高版本。</span><span class="sxs-lookup"><span data-stu-id="329c2-125">You'll need to use version 3.5 or newer.</span></span>
    * <span data-ttu-id="329c2-126">安装 local_o365 插件也将安装[auth_oidc](https://moodle.org/plugins/auth_oidc)和[boost_o365Teams](https://moodle.org/plugins/pluginversions.php?plugin=theme_boost_o365teams)插件。</span><span class="sxs-lookup"><span data-stu-id="329c2-126">Installing the local_o365 plugin will also install the [auth_oidc](https://moodle.org/plugins/auth_oidc) and [boost_o365Teams](https://moodle.org/plugins/pluginversions.php?plugin=theme_boost_o365teams) plugins.</span></span>
1. <span data-ttu-id="329c2-127">以管理员身份登录到您的 Moodle 服务器，然后从左侧导航面板中选择 "**网站管理**"。</span><span class="sxs-lookup"><span data-stu-id="329c2-127">Login to your Moodle server as an administrator, and select **Site administration** from the left navigation panel.</span></span>
1. <span data-ttu-id="329c2-128">选择 "**插件**" 选项卡，然后单击 "**安装插件**"。</span><span class="sxs-lookup"><span data-stu-id="329c2-128">Select the **Plugins** tab, and then click **Install plugins**.</span></span>
1. <span data-ttu-id="329c2-129">在 "**从 ZIP 文件安装插件**" 部分下，单击 "**选择文件**" 按钮。</span><span class="sxs-lookup"><span data-stu-id="329c2-129">Under the **Install plugin from ZIP file** section click the **Choose a file** button.</span></span>
1. <span data-ttu-id="329c2-130">从左侧导航中选择 "**上传文件**" 选项，浏览上面下载的文件，然后单击 "**上载此文件**"。</span><span class="sxs-lookup"><span data-stu-id="329c2-130">Select the **Upload a file** options from the left navigation, browse for the file you downloaded above and click **Upload this file**.</span></span>
1. <span data-ttu-id="329c2-131">再次从左侧导航面板中选择 "**网站管理**" 选项，以返回到您的管理仪表板。</span><span class="sxs-lookup"><span data-stu-id="329c2-131">Select the **Site administration** option from the left navigation panel again to return to your admin dashboard.</span></span> <span data-ttu-id="329c2-132">向下滚动到**本地插件**，然后单击 " **Microsoft Office 365 集成**" 链接。</span><span class="sxs-lookup"><span data-stu-id="329c2-132">Scroll down to the **Local plugins** and click the **Microsoft Office 365 Integration** link.</span></span> <span data-ttu-id="329c2-133">将此配置页在单独的浏览器选项卡中打开，因为在此过程的其余部分将使用它。</span><span class="sxs-lookup"><span data-stu-id="329c2-133">Keep this configuration page open in a separate browser tab as you'll be using it throughout the rest of this process.</span></span>

<span data-ttu-id="329c2-134">您可以在[Moodle 文档](https://docs.moodle.org/34/en/Installing_plugins)中找到有关如何安装 Moodle 插件的详细信息。</span><span class="sxs-lookup"><span data-stu-id="329c2-134">You can find more information on how to install Moodle plugins in the [Moodle documentation](https://docs.moodle.org/34/en/Installing_plugins).</span></span>

<span data-ttu-id="329c2-135">**重要说明：** 保留 Office 365 Moodle 插件配置页在单独的浏览器选项卡中打开，因为您将在整个过程中返回到这组页面。</span><span class="sxs-lookup"><span data-stu-id="329c2-135">**Important Note:** Keep your Office 365 Moodle Plugin configuration page open in a separate browser tab as you will be returning to this set of pages throughout this process.</span></span>

<span data-ttu-id="329c2-136">*尚无 Moodle 网站？*</span><span class="sxs-lookup"><span data-stu-id="329c2-136">*Don't have a Moodle site already?*</span></span> <span data-ttu-id="329c2-137">您可能需要在 Azure 存储库中查看我们的 Moodle，在该存储库中，您可以在[azure 中快速](https://github.com/azure/moodle)部署 Moodle 实例，并根据需要对其进行自定义。</span><span class="sxs-lookup"><span data-stu-id="329c2-137">You might want to check out our Moodle on Azure [repo](https://github.com/azure/moodle) where you can quickly deploy a Moodle instance on Azure and customize it to your needs.</span></span>

## <a name="step-2-configure-the-connection-between-the-office-365-plugin-and-azure-active-directory"></a><span data-ttu-id="329c2-138">步骤2：配置 Office 365 插件与 Azure Active Directory 之间的连接</span><span class="sxs-lookup"><span data-stu-id="329c2-138">Step 2: Configure the connection between the Office 365 plugin and Azure Active Directory</span></span>

> [!VIDEO https://www.youtube.com/embed/FpGEezaJ3SA]

<span data-ttu-id="329c2-139">接下来，你需要将 Moodle 注册为 Azure Active Directory 中的应用程序。</span><span class="sxs-lookup"><span data-stu-id="329c2-139">Next you'll need to register Moodle as an application in your Azure Active Directory.</span></span> <span data-ttu-id="329c2-140">我们提供了 PowerShell 脚本，可帮助你完成此过程。</span><span class="sxs-lookup"><span data-stu-id="329c2-140">We've provided a PowerShell script to help you complete this process.</span></span> <span data-ttu-id="329c2-141">PowerShell 脚本为 Office 365 租户预配新的 Azure AD 应用程序，Office 365 Moodle 插件将使用该应用程序。</span><span class="sxs-lookup"><span data-stu-id="329c2-141">The PowerShell Script provisions a new Azure AD application for your Office 365 tenant, which will be used by the Office 365 Moodle Plugin.</span></span> <span data-ttu-id="329c2-142">该脚本将为您的 O365 租户设置应用程序，为设置的应用程序设置所有必需的回复 Url 和权限，并返回 AppID 和 Key。</span><span class="sxs-lookup"><span data-stu-id="329c2-142">The script will provision the app for your O365 tenant, set up all the required Reply URLs and Permissions for the provisioned app and return the AppID and Key.</span></span> <span data-ttu-id="329c2-143">您可以使用 O365 Moodle 插件设置页面中生成的 AppID 和 Key 为 Moodle server 配置 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="329c2-143">You can use the generated AppID and Key in your O365 Moodle Plugin Setup Page to configure your Moodle server with Azure AD.</span></span> <span data-ttu-id="329c2-144">若要查看 PowerShell 脚本自动化的详细手动步骤，可以在完整文档中查找[插件](https://docs.moodle.org/34/en/Office365#Register_your_Moodle_instance_as_an_Application)。</span><span class="sxs-lookup"><span data-stu-id="329c2-144">If you want to see the detailed manual steps that the PowerShell script is automating, you can find them in the full [documentation for the plugin](https://docs.moodle.org/34/en/Office365#Register_your_Moodle_instance_as_an_Application).</span></span>

### <a name="moodle-tab-for-microsoft-teams-information-flow"></a><span data-ttu-id="329c2-145">Microsoft 团队信息流的 Moodle 选项卡</span><span class="sxs-lookup"><span data-stu-id="329c2-145">Moodle tab for Microsoft Teams information flow</span></span>

<img width="530px" src="~/assets/images/MoodleTabInformationFlow.png" title="Microsoft 团队信息流的 Moodle 选项卡" />

1. <span data-ttu-id="329c2-147">从 "Microsoft Office 365 集成插件" 页中选择 "**设置**" 选项卡。</span><span class="sxs-lookup"><span data-stu-id="329c2-147">From the Microsoft Office 365 Integration plugin page select the **Setup** tab.</span></span>
1. <span data-ttu-id="329c2-148">单击 "**下载 PowerShell 脚本**" 按钮，并将其保存到本地计算机。</span><span class="sxs-lookup"><span data-stu-id="329c2-148">Click the **Download PowerShell Script** button and save it to your local computer.</span></span>
1. <span data-ttu-id="329c2-149">您需要从 ZIP 文件准备 PowerShell 脚本。</span><span class="sxs-lookup"><span data-stu-id="329c2-149">You'll need to prepare the PowerShell script from the ZIP file.</span></span> <span data-ttu-id="329c2-150">为此，请执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="329c2-150">To do so:</span></span>
    * <span data-ttu-id="329c2-151">下载并解压缩`Moodle-AzureAD-Powershell.zip`文件。</span><span class="sxs-lookup"><span data-stu-id="329c2-151">Download and extract the `Moodle-AzureAD-Powershell.zip` file.</span></span>
    * <span data-ttu-id="329c2-152">打开提取的文件夹。</span><span class="sxs-lookup"><span data-stu-id="329c2-152">Open the extracted folder.</span></span>
    * <span data-ttu-id="329c2-153">右键单击该文件， `Moodle-AzureAD-Script.ps1`然后选择 "**属性**"。</span><span class="sxs-lookup"><span data-stu-id="329c2-153">Right-click on the `Moodle-AzureAD-Script.ps1` file and select **Properties**.</span></span>
    * <span data-ttu-id="329c2-154">在 "属性" 窗口的 "**常规**" 选项卡`Unblock`上，选中底部**安全**属性旁边的框。</span><span class="sxs-lookup"><span data-stu-id="329c2-154">Under the **General** tab of the Properties window, check the `Unblock` box next to the **Security** attribute at the bottom.</span></span>
    * <span data-ttu-id="329c2-155">单击“**确定**”。</span><span class="sxs-lookup"><span data-stu-id="329c2-155">Click **OK**.</span></span>
    * <span data-ttu-id="329c2-156">复制提取的文件夹的目录路径。</span><span class="sxs-lookup"><span data-stu-id="329c2-156">Copy the directory path of the extracted folder.</span></span>
1. <span data-ttu-id="329c2-157">接下来，你将以管理员身份运行 PowerShell：</span><span class="sxs-lookup"><span data-stu-id="329c2-157">Next you'll run PowerShell as an administrator:</span></span>
    * <span data-ttu-id="329c2-158">单击“开始”。</span><span class="sxs-lookup"><span data-stu-id="329c2-158">Click Start.</span></span>
    * <span data-ttu-id="329c2-159">类型 PowerShell。</span><span class="sxs-lookup"><span data-stu-id="329c2-159">Type PowerShell.</span></span>
    * <span data-ttu-id="329c2-160">右键单击 "Windows PowerShell"。</span><span class="sxs-lookup"><span data-stu-id="329c2-160">Right-click Windows PowerShell.</span></span>
    * <span data-ttu-id="329c2-161">单击 "以管理员身份运行"。</span><span class="sxs-lookup"><span data-stu-id="329c2-161">Click "Run as Administrator".</span></span>
1. <span data-ttu-id="329c2-162">通过键入`cd ...\...\Moodle-AzureAD-Powershell`目录路径的位置`...\...`定位到已解压缩的目录。</span><span class="sxs-lookup"><span data-stu-id="329c2-162">Navigate to the unzipped directory by typing `cd ...\...\Moodle-AzureAD-Powershell` where `...\...` is the path to the directory.</span></span>
1. <span data-ttu-id="329c2-163">通过以下方式执行 PowerShell 脚本：</span><span class="sxs-lookup"><span data-stu-id="329c2-163">Execute the PowerShell script by:</span></span>
    * <span data-ttu-id="329c2-164">Enter `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser`。</span><span class="sxs-lookup"><span data-stu-id="329c2-164">Enter `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser`.</span></span>
    * <span data-ttu-id="329c2-165">Enter `.\Moodle-AzureAD-Script.ps1`。</span><span class="sxs-lookup"><span data-stu-id="329c2-165">Enter `.\Moodle-AzureAD-Script.ps1`.</span></span>
    * <span data-ttu-id="329c2-166">在弹出窗口中登录到 O365 管理员帐户。</span><span class="sxs-lookup"><span data-stu-id="329c2-166">Login to your O365 Administrator account in the pop-up window.</span></span>
    * <span data-ttu-id="329c2-167">输入 Azure AD 应用程序的名称（例如</span><span class="sxs-lookup"><span data-stu-id="329c2-167">Enter the name of the Azure AD Application (Ex.</span></span> <span data-ttu-id="329c2-168">Moodle/Moodle 插件）。</span><span class="sxs-lookup"><span data-stu-id="329c2-168">Moodle/Moodle plugin).</span></span>
    * <span data-ttu-id="329c2-169">输入 Moodle 服务器的 URL。</span><span class="sxs-lookup"><span data-stu-id="329c2-169">Enter the URL of your Moodle server.</span></span>
    * <span data-ttu-id="329c2-170">复制脚本生成的**应用程序 ID**和**应用程序密钥**并保存它们。</span><span class="sxs-lookup"><span data-stu-id="329c2-170">Copy the **Application ID** and **Application Key** generated by the script and save them.</span></span>
1. <span data-ttu-id="329c2-171">接下来，你需要将 Id 和密钥添加到 Office 365 Moodle 插件。</span><span class="sxs-lookup"><span data-stu-id="329c2-171">Next you'll need to add the Id and Key to the Office 365 Moodle Plugin.</span></span> <span data-ttu-id="329c2-172">返回到插件管理页（网站管理 > 插件 > Microsoft Office 365 集成）。</span><span class="sxs-lookup"><span data-stu-id="329c2-172">Return to the plugin administration page (Site administration > Plugins > Microsoft Office 365 Integration).</span></span>
1. <span data-ttu-id="329c2-173">在 "**设置**" 选项卡上，添加之前复制的**应用程序 Id**和**应用程序密钥**，然后单击 "**保存更改**"。</span><span class="sxs-lookup"><span data-stu-id="329c2-173">On the **Setup** tab add the **Application Id** and **Application Key** you copied previously, then click **Save changes**.</span></span>
1. <span data-ttu-id="329c2-174">页面刷新后，您现在应该可以看到一个新的 "**选择连接方法**" 一节。</span><span class="sxs-lookup"><span data-stu-id="329c2-174">Once the page refreshes you should now see a new section **Choose connection method**.</span></span> <span data-ttu-id="329c2-175">单击标签为 "**默认**" 的复选框，然后再次单击 "**保存更改**"。</span><span class="sxs-lookup"><span data-stu-id="329c2-175">Click the checkbox labeled **Default** and then click **Save changes** again.</span></span>
1. <span data-ttu-id="329c2-176">页面刷新后，你将看到另一个新的**管理员同意 & 其他信息**。</span><span class="sxs-lookup"><span data-stu-id="329c2-176">Once the page refreshes you will see another new section **Admin consent & additional information**.</span></span>
    * <span data-ttu-id="329c2-177">单击 "**提供管理员同意**" 链接，输入您的 Office3 365 全局管理员凭据，然后**接受**授予这些权限。</span><span class="sxs-lookup"><span data-stu-id="329c2-177">Click the **Provide Admin Consent** link, enter your Office3 365 Global Administrator credentials, then **Accept** to grant the permissions.</span></span>
    * <span data-ttu-id="329c2-178">在 " **AZURE AD 租户**" 字段旁边，单击 "**检测**" 按钮。</span><span class="sxs-lookup"><span data-stu-id="329c2-178">Next to the **Azure AD Tenant** field click the **Detect** button.</span></span>
    * <span data-ttu-id="329c2-179">在**OneDrive For BUSINESS URL**旁边，单击 "**检测到**" 按钮。</span><span class="sxs-lookup"><span data-stu-id="329c2-179">Next to the **OneDrive for Business URL** click the **Detect** button.</span></span>
    * <span data-ttu-id="329c2-180">填充字段后，再次单击 "**保存更改**" 按钮。</span><span class="sxs-lookup"><span data-stu-id="329c2-180">Once the fields populate, click the **Save changes** button again.</span></span>
1. <span data-ttu-id="329c2-181">单击 "**更新**" 按钮验证安装，然后**保存所做的更改**。</span><span class="sxs-lookup"><span data-stu-id="329c2-181">Click the **Update** button to verify the installation, then **Save changes**.</span></span>
1. <span data-ttu-id="329c2-182">接下来，你需要在你的 Moodle 服务器和 Azure Active Directory 之间同步用户。</span><span class="sxs-lookup"><span data-stu-id="329c2-182">Next you'll need to synchronize users between your Moodle server and Azure Active Directory.</span></span> <span data-ttu-id="329c2-183">根据您的环境，您可以在此阶段中选择不同的选项。</span><span class="sxs-lookup"><span data-stu-id="329c2-183">Depending on your environment, you may select different options during this stage.</span></span> <span data-ttu-id="329c2-184">请注意，您在此处设置的配置将在每个 Moodle cron 运行（通常一天一天）内运行，以保持所有内容同步。若要开始，请执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="329c2-184">Note that the configuration you set here will run with each Moodle cron run (typically once a day) to keep everything in sync. To get started:</span></span>
    * <span data-ttu-id="329c2-185">切换到 "**同步设置" 选项卡**</span><span class="sxs-lookup"><span data-stu-id="329c2-185">Switch to the **Sync Settings tab**</span></span>
    * <span data-ttu-id="329c2-186">在 "将**用户与 AZURE AD 同步**" 部分中，选择适用于您的环境的复选框。</span><span class="sxs-lookup"><span data-stu-id="329c2-186">In the **Sync users with Azure AD** section, select the checkboxes that apply to your environment.</span></span> <span data-ttu-id="329c2-187">通常情况下，至少要选择：</span><span class="sxs-lookup"><span data-stu-id="329c2-187">Typically you would select at least:</span></span>
        * <span data-ttu-id="329c2-188">在 Moodle 中为 Azure AD 中的用户创建帐户</span><span class="sxs-lookup"><span data-stu-id="329c2-188">Create accounts in Moodle for users in Azure AD</span></span>
        * <span data-ttu-id="329c2-189">为 Azure AD 中的用户更新 Moodle 中的所有帐户</span><span class="sxs-lookup"><span data-stu-id="329c2-189">Update all accounts in Moodle for users in Azure AD</span></span>
    * <span data-ttu-id="329c2-190">在 "**用户创建限制**" 部分，可以设置筛选器，以限制将同步到 Moodle 的 Azure AD 用户。</span><span class="sxs-lookup"><span data-stu-id="329c2-190">In the **User Creation Restriction** section you can setup a filter to limit the Azure AD users that will by synced to Moodle.</span></span>
    * <span data-ttu-id="329c2-191">**用户字段映射**部分将允许你将 Azure AD 自定义为 Moodle 用户配置文件字段映射。</span><span class="sxs-lookup"><span data-stu-id="329c2-191">The **User Field Mapping** section will allow you to customize the Azure AD to Moodle User Profile field mapping.</span></span>
    * <span data-ttu-id="329c2-192">在 "**团队同步**" 部分中，您可以选择自动为您的现有 Moodle 课程创建组（即 "团队"）。</span><span class="sxs-lookup"><span data-stu-id="329c2-192">In the **Teams Sync** section you can choose to automatically create Groups (i.e. Teams) for some, or all, of your existing Moodle courses.</span></span>
1. <span data-ttu-id="329c2-193">若要验证 cron 作业（并在希望第一次运行时手动运行它们），请单击 "将**用户与 AZURE AD 同步**" 一节中的 "**计划任务管理" 页面**链接。</span><span class="sxs-lookup"><span data-stu-id="329c2-193">To validate the cron jobs (and run them manually if you wish to for the first run) click the **Scheduled tasks management page** link in the **Sync users with Azure AD** section.</span></span> <span data-ttu-id="329c2-194">此操作将转到 "**任务计划**" 页。</span><span class="sxs-lookup"><span data-stu-id="329c2-194">This will take you to the **Scheduled Tasks** page.</span></span>
    * <span data-ttu-id="329c2-195">向下滚动并找到**与 AZURE AD 作业同步用户**，然后单击 "**立即运行**"。</span><span class="sxs-lookup"><span data-stu-id="329c2-195">Scroll down and find the job **Sync users with Azure AD** job and click **Run now**.</span></span>
    * <span data-ttu-id="329c2-196">如果选择基于现有课程创建组，则还可以在**Office 365 作业中运行 "创建用户组**"。</span><span class="sxs-lookup"><span data-stu-id="329c2-196">If you chose to create Groups based on existing courses, you can also run the **Create user groups in Office 365** job.</span></span>
1. <span data-ttu-id="329c2-197">返回到插件管理页（网站管理 > 插件 > Microsoft Office 365 集成），然后选择 "**团队设置**" 页。</span><span class="sxs-lookup"><span data-stu-id="329c2-197">Return to the plugin administration page (Site administration > Plugins > Microsoft Office 365 Integration) and select the **Teams Settings** page.</span></span> <span data-ttu-id="329c2-198">您需要配置一些安全设置以启用团队应用集成。</span><span class="sxs-lookup"><span data-stu-id="329c2-198">You'll need to configure some security settings to enable the Teams app integration.</span></span>
    * <span data-ttu-id="329c2-199">若要启用 OpenID Connect，请单击 "**管理身份验证**" 链接，然后在**OpenID 连接**线上单击 "眼睛" 图标（如果它是灰显的）。</span><span class="sxs-lookup"><span data-stu-id="329c2-199">To enable OpenID Connect, click the **Manage Authentication** link, and click the eye icon on the **OpenId Connect** line if it is greyed out.</span></span>
    * <span data-ttu-id="329c2-200">接下来，你需要启用框架嵌入。</span><span class="sxs-lookup"><span data-stu-id="329c2-200">Next you'll need to enable frame embedding.</span></span> <span data-ttu-id="329c2-201">单击 " **HTTP 安全**" 链接，然后单击 "**允许框架嵌入**" 旁边的复选框。</span><span class="sxs-lookup"><span data-stu-id="329c2-201">Click the **HTTP Security** link, then click the checkbox next to **Allow frame embedding**.</span></span>
    * <span data-ttu-id="329c2-202">下一步是启用 web 服务，这将启用 Moodle API 功能。</span><span class="sxs-lookup"><span data-stu-id="329c2-202">The next step is to enable web services which will enable the Moodle API features.</span></span> <span data-ttu-id="329c2-203">单击 "**高级功能**" 链接，然后确保选中 "**启用 web 服务**" 旁边的复选框。</span><span class="sxs-lookup"><span data-stu-id="329c2-203">Click the **Advanced Features** link, then make sure the checkbox next to **Enable web services** is checked.</span></span>
    * <span data-ttu-id="329c2-204">最后，你将需要启用适用于 Office 365 的外部服务。</span><span class="sxs-lookup"><span data-stu-id="329c2-204">Finally you'll need to enabled the external services for Office 365.</span></span> <span data-ttu-id="329c2-205">单击 "**外部服务**" 链接，然后执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="329c2-205">Click the **External services** link then:</span></span>
        * <span data-ttu-id="329c2-206">单击 " **Moodle Office 365 Webservices** " 行上的 "**编辑**"。</span><span class="sxs-lookup"><span data-stu-id="329c2-206">Click **Edit** on the **Moodle Office 365 Webservices** row.</span></span>
        * <span data-ttu-id="329c2-207">选中 "**启用**" 旁边的复选框，然后单击 "**保存更改**"</span><span class="sxs-lookup"><span data-stu-id="329c2-207">Mark the checkbox next to **Enabled**, then click **Save Changes**</span></span>
    * <span data-ttu-id="329c2-208">接下来，你需要编辑经过身份验证的用户权限以允许他们创建 web 服务令牌。</span><span class="sxs-lookup"><span data-stu-id="329c2-208">Next you'll need to edit your authenticated user permissions to allow them to create web service tokens.</span></span> <span data-ttu-id="329c2-209">单击**编辑角色的 "已验证用户"** 链接。</span><span class="sxs-lookup"><span data-stu-id="329c2-209">Click the **Editing role 'Authenticated user'** link.</span></span> <span data-ttu-id="329c2-210">向下滚动并找到 "**创建 web 服务令牌**" 功能，并标记 "**允许**" 复选框。</span><span class="sxs-lookup"><span data-stu-id="329c2-210">Scroll down and find the **Create a web service token** capability and mark the **Allow** checkbox.</span></span>

## <a name="step-3-deploy-the-moodle-assistant-bot-to-azure"></a><span data-ttu-id="329c2-211">步骤3：将 Moodle 助理 Bot 部署到 Azure</span><span class="sxs-lookup"><span data-stu-id="329c2-211">Step 3: Deploy the Moodle Assistant Bot to Azure</span></span>

> [!VIDEO https://www.youtube.com/embed/gbkJxf8FlfY]

<span data-ttu-id="329c2-212">Microsoft 团队免费的 Moodle 助理 Bot 可帮助教师和学生解答有关 Moodle 中的课程、工作分配、成绩和其他信息的问题。</span><span class="sxs-lookup"><span data-stu-id="329c2-212">The free Moodle Assistant Bot for Microsoft Teams helps teachers and students answer questions about their courses, assignments, grades and other information in Moodle.</span></span> <span data-ttu-id="329c2-213">自动程序还会向团队中的学生和教师发送 Moodle 通知。</span><span class="sxs-lookup"><span data-stu-id="329c2-213">The bot also sends Moodle notifications to students and teachers right within Teams.</span></span> <span data-ttu-id="329c2-214">此 bot 是由 Microsoft 维护的开放源项目，[在 GitHub 上提供](https://github.com/microsoft/Moodle-Teams-Bot)。</span><span class="sxs-lookup"><span data-stu-id="329c2-214">This bot is an open source project maintained by Microsoft, and is [available on GitHub](https://github.com/microsoft/Moodle-Teams-Bot).</span></span>

> [!NOTE]
> <span data-ttu-id="329c2-215">在本节中，您将把资源部署到 Azure 订阅，所有资源都将使用**免费**的层进行配置。</span><span class="sxs-lookup"><span data-stu-id="329c2-215">In this section you will deploy resources to your Azure subscription, and all resources will be configured using the **free** tier.</span></span> <span data-ttu-id="329c2-216">根据你的 bot 的使用情况，你可能需要扩展这些资源。</span><span class="sxs-lookup"><span data-stu-id="329c2-216">Depending on the usage of your bot, you may need to scale these resources.</span></span>
> <span data-ttu-id="329c2-217">如果只想使用不带机器人的 Moodle 选项卡，请跳到[步骤 4](#step-4-deploy-your-microsoft-teams-app)。</span><span class="sxs-lookup"><span data-stu-id="329c2-217">If you want to just use the Moodle tab without the bot, skip to [step 4](#step-4-deploy-your-microsoft-teams-app).</span></span>

### <a name="moodle-bot-information-flow"></a><span data-ttu-id="329c2-218">Moodle bot 信息流</span><span class="sxs-lookup"><span data-stu-id="329c2-218">Moodle bot information flow</span></span>

<img width="530px" src="~/assets/images/MoodleBotInformationFlow.png" title="Microsoft 团队的 Moodle bot 信息流" />

<span data-ttu-id="329c2-220">若要安装机器人，首先需要在[Microsoft Identity 平台](https://identity.microsoft.com/Landing)上注册它。</span><span class="sxs-lookup"><span data-stu-id="329c2-220">To install the bot, you'll first need to register it on the [Microsoft Identity Platform](https://identity.microsoft.com/Landing).</span></span> <span data-ttu-id="329c2-221">这将允许你的 Bot 针对你的 Microsoft 终结点进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="329c2-221">This allows your Bot to authenticate against your Microsoft endpoints.</span></span> <span data-ttu-id="329c2-222">若要注册你的 bot：</span><span class="sxs-lookup"><span data-stu-id="329c2-222">To register your bot:</span></span>

1. <span data-ttu-id="329c2-223">返回到插件管理页（网站管理 > 插件 > Microsoft Office 365 集成），然后选择 "**团队设置**" 选项卡。</span><span class="sxs-lookup"><span data-stu-id="329c2-223">Return to the plugin administration page (Site administration > Plugins > Microsoft Office 365 Integration) and select the **Teams Settings** tab.</span></span>
1. <span data-ttu-id="329c2-224">单击 " **Microsoft 应用程序注册门户**" 链接，并使用你的 microsoft Id 登录。</span><span class="sxs-lookup"><span data-stu-id="329c2-224">Click the **Microsoft Application Registration Portal** link and login with your Microsoft Id.</span></span>
1. <span data-ttu-id="329c2-225">输入您的应用程序的名称（例如，</span><span class="sxs-lookup"><span data-stu-id="329c2-225">Enter a name for your app (Eg.</span></span> <span data-ttu-id="329c2-226">MoodleBot），然后单击 "**创建**" 按钮。</span><span class="sxs-lookup"><span data-stu-id="329c2-226">MoodleBot) and click the **Create** button.</span></span>
1. <span data-ttu-id="329c2-227">复制**应用程序 Id** ，并将其粘贴到 "**团队设置**" 页上的 " **Bot 应用程序 id** " 字段中。</span><span class="sxs-lookup"><span data-stu-id="329c2-227">Copy the **Application Id** and paste it into the **Bot Application ID** field on the **Team Settings** page.</span></span>
1. <span data-ttu-id="329c2-228">单击 "**生成新密码**" 按钮。</span><span class="sxs-lookup"><span data-stu-id="329c2-228">Click the **Generate New Password** button.</span></span> <span data-ttu-id="329c2-229">复制生成的密码并将其粘贴到 "**团队设置**" 页上的 "**机器人应用程序密码**" 字段中。</span><span class="sxs-lookup"><span data-stu-id="329c2-229">Copy the generated password and and paste it into the **Bot Application Password** field on the **Team Settings** page.</span></span>
1. <span data-ttu-id="329c2-230">滚动到窗体底部，然后单击 "**保存更改**"。</span><span class="sxs-lookup"><span data-stu-id="329c2-230">Scroll to the bottom of the form and click **Save Changes**.</span></span>

<span data-ttu-id="329c2-231">现在，您已经生成了应用程序 Id 和密码，现在可以将机器人部署到 Azure 了。</span><span class="sxs-lookup"><span data-stu-id="329c2-231">Now that you've generated your Application Id and Password, it's time to deploy your bot to Azure.</span></span> <span data-ttu-id="329c2-232">单击 "**部署到 Azure** " 按钮，并填写包含必要信息的表单（Bot 应用程序 Id、Bot 应用程序密码和 Moodle 密码位于 "**团队设置**" 页上，并且 Azure 信息在 "**设置**" 页上）。</span><span class="sxs-lookup"><span data-stu-id="329c2-232">Click on the **Deploy to Azure** button and fill out the form with the necessary information (the Bot Application Id, Bot Application Password and the Moodle Secret are on the **Team Settings** page, and the Azure information is on the **Setup** page).</span></span> <span data-ttu-id="329c2-233">填写填写表单后，单击复选框以接受条款和条件，然后单击 "**购买**" 按钮（所有 Azure 资源都将部署到 "免费" 层）。</span><span class="sxs-lookup"><span data-stu-id="329c2-233">Once you've got the form filled out, click the check box to agree to the terms and conditions then click the **Purchase** button (all Azure resources are deployed to the free tier).</span></span>

<span data-ttu-id="329c2-234">将资源部署到 Azure 后，需要使用 it 的邮件终结点配置 Office 365 Moodle 插件。</span><span class="sxs-lookup"><span data-stu-id="329c2-234">Once the resources are finished deploying to Azure, you'll need to configure the Office 365 Moodle plugin with it's messaging endpoint.</span></span> <span data-ttu-id="329c2-235">首先，你需要从 Azure 中的你的 Bot 获取终结点。</span><span class="sxs-lookup"><span data-stu-id="329c2-235">First, you'll need to get the endpoint from you Bot in Azure.</span></span> <span data-ttu-id="329c2-236">为此，请执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="329c2-236">To do that:</span></span>

1. <span data-ttu-id="329c2-237">如果您尚未登录到 Azure 门户，请登录到[Azure 门户](https://portal.azure.com)。</span><span class="sxs-lookup"><span data-stu-id="329c2-237">If you aren't already, log into the [Azure portal](https://portal.azure.com).</span></span>
2. <span data-ttu-id="329c2-238">在左窗格中，选择 "**资源组**"。</span><span class="sxs-lookup"><span data-stu-id="329c2-238">In the left pane select **Resource groups**.</span></span>
3. <span data-ttu-id="329c2-239">从列表中选择您刚刚使用（或创建）的您在部署 Bot 时使用的资源组。</span><span class="sxs-lookup"><span data-stu-id="329c2-239">From the list select the resource group you just used (or created) while deploying your Bot.</span></span>
4. <span data-ttu-id="329c2-240">从组中资源列表的列表中选择 " **WebApp Bot** " 资源。</span><span class="sxs-lookup"><span data-stu-id="329c2-240">Select the **WebApp Bot** resource from the list of resources in the group.</span></span>
5. <span data-ttu-id="329c2-241">从 "**概述**" 部分复制**邮件终结点**。</span><span class="sxs-lookup"><span data-stu-id="329c2-241">Copy the **Messaging Endpoint** from the **Overview** section.</span></span>
6. <span data-ttu-id="329c2-242">在 Moodle 中，打开 Office 365 Moodle 插件的 "**团队设置**" 页。</span><span class="sxs-lookup"><span data-stu-id="329c2-242">In Moodle, open the **Team Settings** page of your Office 365 Moodle Plugin.</span></span>
7. <span data-ttu-id="329c2-243">在**机器人终结点**字段中粘贴刚复制的 URL，并将 word*消息*更改为*webhook*。</span><span class="sxs-lookup"><span data-stu-id="329c2-243">In the **Bot Endpoint** field paste the URL you just copied and change the word *messages* to *webhook*.</span></span> <span data-ttu-id="329c2-244">该 URL 现在应如下所示`https://botname.azurewebsites.net/api/webhook`</span><span class="sxs-lookup"><span data-stu-id="329c2-244">The URL should now look like `https://botname.azurewebsites.net/api/webhook`</span></span>
8. <span data-ttu-id="329c2-245">单击 "**保存更改**"</span><span class="sxs-lookup"><span data-stu-id="329c2-245">Click **Save Changes**</span></span>
9. <span data-ttu-id="329c2-246">保存更改后，返回到 "**团队设置**" 选项卡，单击 "**下载清单文件**" 按钮并将清单包保存到您的计算机上（将在下一节中使用它）。</span><span class="sxs-lookup"><span data-stu-id="329c2-246">Once your changes have saved, go back to the **Team Settings** tab, click the **Download manifest file** button and save the manifest package to your computer (you'll use it in the next section).</span></span>

## <a name="step-4-deploy-your-microsoft-teams-app"></a><span data-ttu-id="329c2-247">步骤4：部署 Microsoft 团队应用程序</span><span class="sxs-lookup"><span data-stu-id="329c2-247">Step 4: Deploy your Microsoft Teams app</span></span>

> [!VIDEO https://www.youtube.com/embed/2rMb7gtM_ZM]

<span data-ttu-id="329c2-248">现在，你已将你的 Bot 部署到 Azure 并配置为与你的 Moodle 服务器通信，现在是部署 Microsoft 团队应用的时候了。</span><span class="sxs-lookup"><span data-stu-id="329c2-248">Now that you have your Bot deployed to Azure and configured to talk to your Moodle server, it's time to deploy your Microsoft Teams app.</span></span> <span data-ttu-id="329c2-249">为此，您将从上一步中加载从 "Office 365 Moodle 插件团队设置" 页下载的清单文件。</span><span class="sxs-lookup"><span data-stu-id="329c2-249">To do this you'll load the manifest file you downloaded from the Office 365 Moodle Plugin Team Settings page in the previous step.</span></span>

<span data-ttu-id="329c2-250">在安装应用程序之前，您需要确保已启用外部应用和应用程序上传。</span><span class="sxs-lookup"><span data-stu-id="329c2-250">Before you can install the app you'll need to make sure external apps and uploading of apps is enabled.</span></span> <span data-ttu-id="329c2-251">若要执行此操作，您可以执行[以下步骤](https://docs.microsoft.com/microsoftteams/platform/get-started/get-started-tenant)。</span><span class="sxs-lookup"><span data-stu-id="329c2-251">To do so you can follow [these steps](https://docs.microsoft.com/microsoftteams/platform/get-started/get-started-tenant).</span></span> <span data-ttu-id="329c2-252">确保已启用外部应用程序后，您可以按照以下步骤部署您的应用程序。</span><span class="sxs-lookup"><span data-stu-id="329c2-252">Once you've ensured that external apps are enabled, you can follow the steps below to deploy your app.</span></span>

1. <span data-ttu-id="329c2-253">打开 Microsoft 团队。</span><span class="sxs-lookup"><span data-stu-id="329c2-253">Open Microsoft Teams.</span></span>
2. <span data-ttu-id="329c2-254">单击导航栏左上角的 "**存储**" 图标。</span><span class="sxs-lookup"><span data-stu-id="329c2-254">Click the **Store** icon on the lower-left of the navigation bar.</span></span>
3. <span data-ttu-id="329c2-255">从选项列表中单击 "**上载自定义应用程序**" 链接。</span><span class="sxs-lookup"><span data-stu-id="329c2-255">Click the **Upload a custom app** link from the list of options.</span></span> <span data-ttu-id="329c2-256">*注意：* 如果以全局管理方式登录，则可以选择将应用上载到组织的应用商店，否则您将只能为您所属的团队加载应用程序。</span><span class="sxs-lookup"><span data-stu-id="329c2-256">*Note:* If you're logged in as a global administer you'll have the option of uploading the app to your organization's app store, otherwise you'll only be able to load the app for a team of which you are a member.</span></span>
4. <span data-ttu-id="329c2-257">选择以前`manifest.zip`下载的包，然后单击 "**保存**"。</span><span class="sxs-lookup"><span data-stu-id="329c2-257">Select the `manifest.zip` package you downloaded previously and click **Save**.</span></span> <span data-ttu-id="329c2-258">如果您尚未下载清单包，可以从 Moodle 中的 "插件配置" 页的 "**团队设置**" 选项卡执行此操作。</span><span class="sxs-lookup"><span data-stu-id="329c2-258">If you haven't yet downloaded the manifest package, you can do so from the **Team Settings** tab of the plugin configuration page in Moodle.</span></span>

<span data-ttu-id="329c2-259">现在，您已安装应用程序，可以将选项卡添加到您有权访问的任何频道。</span><span class="sxs-lookup"><span data-stu-id="329c2-259">Now that you have the app installed you can add the tab to any channel that you have access to.</span></span> <span data-ttu-id="329c2-260">若要执行此操作，请导航到频道**+** ，单击符号并从列表中选择您的应用程序。</span><span class="sxs-lookup"><span data-stu-id="329c2-260">To do so navigate to the channel, click the **+** symbol and select your app from the list.</span></span> <span data-ttu-id="329c2-261">按照提示完成将 Moodle 课程选项卡添加到频道中。</span><span class="sxs-lookup"><span data-stu-id="329c2-261">Follow the prompts to finish adding your Moodle course tab to a channel.</span></span>

<span data-ttu-id="329c2-262">就是这么简单。</span><span class="sxs-lookup"><span data-stu-id="329c2-262">That's it!</span></span> <span data-ttu-id="329c2-263">你和你的团队现在可以直接从 Microsoft 团队开始使用你的 Moodle 课程。</span><span class="sxs-lookup"><span data-stu-id="329c2-263">You and your team, can now start working with your Moodle courses directly from Microsoft Teams.</span></span>

<span data-ttu-id="329c2-264">若要与我们共享任何功能请求或反馈，请访问我们的[用户语音页面](https://microsoftteams.uservoice.com/forums/916759-moodle)。</span><span class="sxs-lookup"><span data-stu-id="329c2-264">To share any feature requests or feedback with us, please visit our [User Voice page](https://microsoftteams.uservoice.com/forums/916759-moodle).</span></span>

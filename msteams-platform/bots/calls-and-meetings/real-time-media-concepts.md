---
title: Microsoft 团队的实时媒体呼叫和联机会议
description: 了解构建机器人中的关键概念，这些概念可执行实时音频和视频呼叫和联机会议。
keywords: 音频流视频流音频/视频呼叫会议实时媒体应用程序托管的媒体服务托管的媒体
ms.openlocfilehash: 0ec99d1caa8810d292170c7c70a1518de7301873
ms.sourcegitcommit: 4329a94918263c85d6c65ff401f571556b80307b
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/01/2020
ms.locfileid: "41673158"
---
# <a name="real-time-media-calls-and-meetings-with-microsoft-teams"></a><span data-ttu-id="4caaa-104">Microsoft 团队的实时媒体呼叫和会议</span><span class="sxs-lookup"><span data-stu-id="4caaa-104">Real-time media calls and meetings with Microsoft Teams</span></span>

<span data-ttu-id="4caaa-105">实时媒体平台使 bot 能够使用实时语音、视频和屏幕共享与 Microsoft 团队通话和会议进行交互。</span><span class="sxs-lookup"><span data-stu-id="4caaa-105">The Real-time Media Platform enables bots to interact with Microsoft Teams calls and meetings using real-time voice, video, and screen sharing.</span></span> <span data-ttu-id="4caaa-106">这是一种高级功能，使机器人能够*按帧*发送和接收语音和视频内容帧。</span><span class="sxs-lookup"><span data-stu-id="4caaa-106">This is an advanced capability which allows the bot to send and receive voice and video content *frame by frame*.</span></span> <span data-ttu-id="4caaa-107">Bot 具有对语音、视频和屏幕共享媒体流的 "原始" 访问权限。</span><span class="sxs-lookup"><span data-stu-id="4caaa-107">The bot has "raw" access to the voice, video, and screen sharing media streams.</span></span> <span data-ttu-id="4caaa-108">（处理媒体本身的 bot 称为 "_应用程序托管的媒体_bot"，而不是依赖于所有媒体处理的实时媒体平台的更简单的_服务托管媒体_bot。）</span><span class="sxs-lookup"><span data-stu-id="4caaa-108">(Bots which process media themselves are called _application-hosted media_ bots, as opposed to simpler _service-hosted media_ bots that rely on the Real-time Media platform for all media processing.)</span></span>

<span data-ttu-id="4caaa-109">例如，在使用 bot 的1:1 呼叫中，当用户说话时，bot 将每秒收到50音频帧，每个帧包含20毫秒（ms）的音频。</span><span class="sxs-lookup"><span data-stu-id="4caaa-109">For example, in a 1:1 call with a bot, as the user speaks, the bot will receive 50 audio frames per second, with each frame containing 20 milliseconds (ms) of audio.</span></span> <span data-ttu-id="4caaa-110">在接收音频帧时，应用程序托管的媒体 bot 可以执行实时语音识别，而无需在用户停止讲话后等待录制。</span><span class="sxs-lookup"><span data-stu-id="4caaa-110">An application-hosted media bot can perform real-time speech recognition as the audio frames are received, rather than having to wait for a recording after the user has stopped speaking.</span></span> <span data-ttu-id="4caaa-111">自动程序还可以发送和接收高清晰度解析视频，包括基于视频的屏幕共享内容。</span><span class="sxs-lookup"><span data-stu-id="4caaa-111">The bot can also send and receive high-definition-resolution video, including video-based screen sharing content.</span></span>

<span data-ttu-id="4caaa-112">该平台提供了简单的类似于套接字的 API，以用于发送和接收媒体，并处理音频/视频数据包的实时编码和解码使用编码解码器（如 g.722）的音频/视频数据包和视频的 .H。</span><span class="sxs-lookup"><span data-stu-id="4caaa-112">The platform provides a simple socket-like API for the bot to send and receive media, and handles the real-time encoding and decoding of audio/video packets using codecs such as SILK and G.722 for audio and H.264 for video.</span></span> <span data-ttu-id="4caaa-113">该平台还会自动处理所有媒体数据包加密/解密和数据包网络传输，因此，bot 只需关注实际音频/视频内容。</span><span class="sxs-lookup"><span data-stu-id="4caaa-113">The platform also handles all media packet encryption/decryption and packet network transmission automatically, so the bot just needs to concern itself with the actual audio/video content.</span></span> <span data-ttu-id="4caaa-114">实时媒体机器人可能会加入1:1 呼叫以及与多个参与者的会议。</span><span class="sxs-lookup"><span data-stu-id="4caaa-114">A real-time media bot may participate in 1:1 calls as well as meetings with multiple participants.</span></span>

<span data-ttu-id="4caaa-115">本文介绍与构建可与 Microsoft 团队进行实时音频/视频呼叫的 bot 相关的关键概念。</span><span class="sxs-lookup"><span data-stu-id="4caaa-115">This article introduces key concepts related to building a bot that can conduct real-time audio/video calls with Microsoft Teams.</span></span>

## <a name="media-session"></a><span data-ttu-id="4caaa-116">媒体会话</span><span class="sxs-lookup"><span data-stu-id="4caaa-116">Media session</span></span>

<span data-ttu-id="4caaa-117">当实时媒体 bot 应答传入呼叫或加入 Microsoft 团队会议时，它必须声明要支持的形式。</span><span class="sxs-lookup"><span data-stu-id="4caaa-117">When a real-time media bot answers an incoming call or joins a Microsoft Teams meeting, it must declare what modalities it intends to support.</span></span> <span data-ttu-id="4caaa-118">对于每个受支持的模态，bot 都会声明它是只能发送和接收媒体、仅接收还是发送。</span><span class="sxs-lookup"><span data-stu-id="4caaa-118">For each supported modality, the bot declares whether it can send and receive media, receive only, or send only.</span></span> <span data-ttu-id="4caaa-119">例如，设计用于处理1:1 团队呼叫的 bot 可能希望发送和接收音频，但仅*发送*视频（因为它不需要接收呼叫者的视频）。</span><span class="sxs-lookup"><span data-stu-id="4caaa-119">For example, a bot designed to handle 1:1 Teams calls may wish to both send and receive audio, but only *send* video (as it does not need to receive the video of the caller).</span></span> <span data-ttu-id="4caaa-120">在 bot 和团队呼叫者或会议之间建立的一组音频和视频形式称为**媒体会话**。</span><span class="sxs-lookup"><span data-stu-id="4caaa-120">The set of audio and video modalities established between the bot and the Teams caller or meeting is called the **media session**.</span></span>

<span data-ttu-id="4caaa-121">支持两种类型的视频形式：**主要视频**和**基于视频的屏幕共享**。</span><span class="sxs-lookup"><span data-stu-id="4caaa-121">Two types of video modalities are supported: **main video** and **video-based screen sharing**.</span></span> <span data-ttu-id="4caaa-122">主视频用于从用户的网络摄像头传输视频。</span><span class="sxs-lookup"><span data-stu-id="4caaa-122">Main video is used to transport the video from a user's webcam.</span></span> <span data-ttu-id="4caaa-123">基于视频的屏幕共享允许用户将其屏幕共享为视频流。</span><span class="sxs-lookup"><span data-stu-id="4caaa-123">Video-based screen sharing allows a user to share his or her screen as a video stream.</span></span> <span data-ttu-id="4caaa-124">平台允许机器人发送和/或接收*两种*视频类型。</span><span class="sxs-lookup"><span data-stu-id="4caaa-124">The platform allows a bot to send and/or receive *both* video types.</span></span>

<span data-ttu-id="4caaa-125">加入团队会议时，bot 可以同时接收多个主视频流，每个媒体会话最多10个。</span><span class="sxs-lookup"><span data-stu-id="4caaa-125">When joined to a Teams meeting, a bot can receive multiple main video streams simultaneously — up to 10 per media session.</span></span> <span data-ttu-id="4caaa-126">这将允许机器人 "查看" 会议中的多个参与者。</span><span class="sxs-lookup"><span data-stu-id="4caaa-126">This allows the bot to "see" more than one participant in the meeting.</span></span>

## <a name="frames-and-frame-rate"></a><span data-ttu-id="4caaa-127">帧和帧速率</span><span class="sxs-lookup"><span data-stu-id="4caaa-127">Frames and frame rate</span></span>

<span data-ttu-id="4caaa-128">实时媒体机器人与媒体会话的音频和视频形式直接交互。</span><span class="sxs-lookup"><span data-stu-id="4caaa-128">A real-time media bot interacts directly with the audio and video modalities of a media session.</span></span> <span data-ttu-id="4caaa-129">这意味着，bot 将以一系列**帧**的形式发送和/或接收媒体，其中每个帧表示一个内容单元。</span><span class="sxs-lookup"><span data-stu-id="4caaa-129">This means the bot is sending and/or receiving media as a sequence of **frames**, where each frame represents a unit of content.</span></span> <span data-ttu-id="4caaa-130">音频的一秒可能以50帧的序列进行传输，每个帧包含20毫秒（ms）—一次语音内容的 1/50。</span><span class="sxs-lookup"><span data-stu-id="4caaa-130">One second of audio may be transmitted as a sequence of 50 frames, with each frame containing 20 milliseconds (ms) —1/50th of a second — of speech content.</span></span> <span data-ttu-id="4caaa-131">一秒的视频可能被作为30个静止图像的一个序列进行切片，每个视频在下一个视频帧显示前仅查看 33.3 ms （1/30 秒）。</span><span class="sxs-lookup"><span data-stu-id="4caaa-131">One second worth of video may be sliced as a sequence of 30 still images, each intended to be viewed for just 33.3ms — 1/30th of a second — before the next video frame is displayed.</span></span> <span data-ttu-id="4caaa-132">每秒传输或呈现的帧数称为**帧速率**。</span><span class="sxs-lookup"><span data-stu-id="4caaa-132">The number of frames transmitted or rendered per second is called the **frame rate**.</span></span> <span data-ttu-id="4caaa-133">"30fps" 表示每秒30帧。</span><span class="sxs-lookup"><span data-stu-id="4caaa-133">"30fps" indicates 30 frames per second.</span></span>

## <a name="audio-format"></a><span data-ttu-id="4caaa-134">音频格式</span><span class="sxs-lookup"><span data-stu-id="4caaa-134">Audio format</span></span>

<span data-ttu-id="4caaa-135">每秒两个音频表示为 16000**样本**，每个样本包含16位数据。</span><span class="sxs-lookup"><span data-stu-id="4caaa-135">Each second of audio is represented as 16,000 **samples**, with each sample containing 16-bits of data.</span></span> <span data-ttu-id="4caaa-136">20毫秒音频帧包含320个样本（640个字节的数据）。</span><span class="sxs-lookup"><span data-stu-id="4caaa-136">A 20ms audio frame contains 320 samples (640 bytes of data).</span></span>

## <a name="video-format"></a><span data-ttu-id="4caaa-137">视频格式</span><span class="sxs-lookup"><span data-stu-id="4caaa-137">Video format</span></span>

<span data-ttu-id="4caaa-138">视频支持几种格式。</span><span class="sxs-lookup"><span data-stu-id="4caaa-138">There are several formats supported for video.</span></span> <span data-ttu-id="4caaa-139">视频格式的两个关键属性是其**帧大小**和**颜色格式**。</span><span class="sxs-lookup"><span data-stu-id="4caaa-139">Two key properties of a video format are its **frame size** and **color format**.</span></span> <span data-ttu-id="4caaa-140">支持的帧大小包括640x360 （"360p"）、1280x720 （"720p"）和1920x1080 （"1080p"）。</span><span class="sxs-lookup"><span data-stu-id="4caaa-140">Supported frame sizes include 640x360 ("360p"), 1280x720 ("720p"), and 1920x1080 ("1080p").</span></span> <span data-ttu-id="4caaa-141">支持的颜色格式包括 NV12 （12位/像素）和 RGB24 （24位/像素）。</span><span class="sxs-lookup"><span data-stu-id="4caaa-141">Supported color formats include NV12 (12 bits per pixel) and RGB24 (24 bits per pixel).</span></span>

<span data-ttu-id="4caaa-142">"720p" 视频帧包含921600像素（1280乘以720）。</span><span class="sxs-lookup"><span data-stu-id="4caaa-142">A "720p" video frame contains 921,600 pixels (1280 times 720).</span></span> <span data-ttu-id="4caaa-143">在 RGB24 颜色格式中，每个像素表示为3个字节（24位），每个红色、绿色和蓝色分量由一个字节组成。</span><span class="sxs-lookup"><span data-stu-id="4caaa-143">In the RGB24 color format, each pixel is represented as 3 bytes (24-bits) comprised of one byte each of red, green, and blue color components.</span></span> <span data-ttu-id="4caaa-144">因此，单个 720p RGB24 视频帧需要2764800字节的数据（921600像素乘以3字节/像素）。</span><span class="sxs-lookup"><span data-stu-id="4caaa-144">Therefore, a single 720p RGB24 video frame requires 2,764,800 bytes of data (921,600 pixels times 3 bytes/pixel).</span></span> <span data-ttu-id="4caaa-145">如果帧速率为30fps，则发送 720p RGB24 视频帧意味着处理大约 80 MB/s 的内容（在网络传输之前，通过 H-p 视频编解码器对其进行了充分压缩）。</span><span class="sxs-lookup"><span data-stu-id="4caaa-145">At a frame rate of 30fps, sending 720p RGB24 video frames means processing approximately 80 MB/s of content (which is substantially compressed by the H.264 video codec before network transmission).</span></span>

<span data-ttu-id="4caaa-146">平台的高级功能允许 bot 以**编码**的 h-p 帧的形式发送/接收视频。</span><span class="sxs-lookup"><span data-stu-id="4caaa-146">An advanced capability of the platform allows a bot to send/receive video as **encoded** H.264 frames.</span></span> <span data-ttu-id="4caaa-147">这支持提供其自己的 H-p 编码器/解码器的 bot，或者不需要将视频流解码为原始 RGB24 或 NV12 位图。</span><span class="sxs-lookup"><span data-stu-id="4caaa-147">This supports bots which provide their own H.264 encoder/decoder, or do not need the video stream decoded into raw RGB24 or NV12 bitmaps.</span></span>

## <a name="active-and-dominant-speakers"></a><span data-ttu-id="4caaa-148">活动和主要扬声器</span><span class="sxs-lookup"><span data-stu-id="4caaa-148">Active and dominant speakers</span></span>

<span data-ttu-id="4caaa-149">加入由多个参与者组成的团队会议时，bot 可以识别当前正在发言的会议参与者。</span><span class="sxs-lookup"><span data-stu-id="4caaa-149">When joined to a Teams meeting consisting of multiple participants, a bot can identify which meeting participants are currently speaking.</span></span> <span data-ttu-id="4caaa-150">**主动扬声器**标识在每个收到的音频帧中听到的参与者。</span><span class="sxs-lookup"><span data-stu-id="4caaa-150">**Active speakers** identify which participants are being heard in each received audio frame.</span></span> <span data-ttu-id="4caaa-151">**主要扬声器**标识在组对话中当前最活跃（或 "主要"）的参与者，即使在每个音频帧中听不到他们的语音也是如此。</span><span class="sxs-lookup"><span data-stu-id="4caaa-151">**Dominant speakers** identify which participants are currently most active (or "dominant") in the group conversation, even though their voice may not be heard in every audio frame.</span></span> <span data-ttu-id="4caaa-152">在不同的参与者轮流发言的情况下，主要扬声器集可能会发生变化。</span><span class="sxs-lookup"><span data-stu-id="4caaa-152">The set of dominant speakers can change as different participants take turns speaking.</span></span>

## <a name="video-subscription"></a><span data-ttu-id="4caaa-153">视频订阅</span><span class="sxs-lookup"><span data-stu-id="4caaa-153">Video subscription</span></span>

<span data-ttu-id="4caaa-154">在1:1 呼叫中，如果启用了 bot 以接收视频，则 bot 将自动接收呼叫者的视频。</span><span class="sxs-lookup"><span data-stu-id="4caaa-154">In a 1:1 call, the bot will automatically receive the video of the caller if the bot is enabled to receive video.</span></span> <span data-ttu-id="4caaa-155">在团队会议中，bot 必须向要观看的参与者指示要查看的平台。</span><span class="sxs-lookup"><span data-stu-id="4caaa-155">In a Teams meeting, the bot must indicate to the platform which participants it wants to see.</span></span> <span data-ttu-id="4caaa-156">**视频订阅**是由 bot 接收参与者的主要视频或屏幕共享内容的请求。</span><span class="sxs-lookup"><span data-stu-id="4caaa-156">A **video subscription** is a request by the bot to receive a participant’s main video or screen-sharing content.</span></span> <span data-ttu-id="4caaa-157">当会议参与者召开对话时，自动程序可能会根据主要发言人集或通知（指示当前屏幕共享的参与者）的更新来修改所需的视频订阅。</span><span class="sxs-lookup"><span data-stu-id="4caaa-157">As the participants in the meeting conduct their conversation, the bot may modify its desired video subscriptions based on updates of the dominant speaker set or notifications indicating which participant is currently screen sharing.</span></span>

## <a name="developer-resources"></a><span data-ttu-id="4caaa-158">开发人员资源</span><span class="sxs-lookup"><span data-stu-id="4caaa-158">Developer resources</span></span>

<span data-ttu-id="4caaa-159">若要开发应用程序承载的媒体 bot，您必须在 Visual Studio 项目中安装以下 NuGet 包：</span><span class="sxs-lookup"><span data-stu-id="4caaa-159">To develop an application-hosted media bot, you must install the following NuGet package within your Visual Studio project:</span></span>

- [<span data-ttu-id="4caaa-160">Microsoft. Media .NET 库</span><span class="sxs-lookup"><span data-stu-id="4caaa-160">Microsoft.Graph.Calls.Media .NET library</span></span>](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/)

<span data-ttu-id="4caaa-161">应用程序托管的媒体 bot 需要 .NET/c # 和 Windows Server，如[应用程序托管媒体 bot 的要求和注意事项](requirements-considerations-application-hosted-media-bots.md#application-hosted-media-bot-development-requires-cnet-and-windows-server)中所述。</span><span class="sxs-lookup"><span data-stu-id="4caaa-161">Application-hosted media bots require .NET/C# and Windows Server, as described in detail in [Requirements and considerations for application-hosted media bots](requirements-considerations-application-hosted-media-bots.md#application-hosted-media-bot-development-requires-cnet-and-windows-server).</span></span>

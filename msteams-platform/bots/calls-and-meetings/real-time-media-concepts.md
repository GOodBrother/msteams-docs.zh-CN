---
title: Microsoft 团队的实时媒体呼叫和联机会议
description: 了解构建机器人中的关键概念，这些概念可执行实时音频和视频呼叫和联机会议。
keywords: 音频流视频流音频/视频呼叫会议实时媒体应用程序托管的媒体服务托管的媒体
ms.openlocfilehash: 0ec99d1caa8810d292170c7c70a1518de7301873
ms.sourcegitcommit: 4329a94918263c85d6c65ff401f571556b80307b
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/01/2020
ms.locfileid: "41673158"
---
# <a name="real-time-media-calls-and-meetings-with-microsoft-teams"></a>Microsoft 团队的实时媒体呼叫和会议

实时媒体平台使 bot 能够使用实时语音、视频和屏幕共享与 Microsoft 团队通话和会议进行交互。 这是一种高级功能，使机器人能够*按帧*发送和接收语音和视频内容帧。 Bot 具有对语音、视频和屏幕共享媒体流的 "原始" 访问权限。 （处理媒体本身的 bot 称为 "_应用程序托管的媒体_bot"，而不是依赖于所有媒体处理的实时媒体平台的更简单的_服务托管媒体_bot。）

例如，在使用 bot 的1:1 呼叫中，当用户说话时，bot 将每秒收到50音频帧，每个帧包含20毫秒（ms）的音频。 在接收音频帧时，应用程序托管的媒体 bot 可以执行实时语音识别，而无需在用户停止讲话后等待录制。 自动程序还可以发送和接收高清晰度解析视频，包括基于视频的屏幕共享内容。

该平台提供了简单的类似于套接字的 API，以用于发送和接收媒体，并处理音频/视频数据包的实时编码和解码使用编码解码器（如 g.722）的音频/视频数据包和视频的 .H。 该平台还会自动处理所有媒体数据包加密/解密和数据包网络传输，因此，bot 只需关注实际音频/视频内容。 实时媒体机器人可能会加入1:1 呼叫以及与多个参与者的会议。

本文介绍与构建可与 Microsoft 团队进行实时音频/视频呼叫的 bot 相关的关键概念。

## <a name="media-session"></a>媒体会话

当实时媒体 bot 应答传入呼叫或加入 Microsoft 团队会议时，它必须声明要支持的形式。 对于每个受支持的模态，bot 都会声明它是只能发送和接收媒体、仅接收还是发送。 例如，设计用于处理1:1 团队呼叫的 bot 可能希望发送和接收音频，但仅*发送*视频（因为它不需要接收呼叫者的视频）。 在 bot 和团队呼叫者或会议之间建立的一组音频和视频形式称为**媒体会话**。

支持两种类型的视频形式：**主要视频**和**基于视频的屏幕共享**。 主视频用于从用户的网络摄像头传输视频。 基于视频的屏幕共享允许用户将其屏幕共享为视频流。 平台允许机器人发送和/或接收*两种*视频类型。

加入团队会议时，bot 可以同时接收多个主视频流，每个媒体会话最多10个。 这将允许机器人 "查看" 会议中的多个参与者。

## <a name="frames-and-frame-rate"></a>帧和帧速率

实时媒体机器人与媒体会话的音频和视频形式直接交互。 这意味着，bot 将以一系列**帧**的形式发送和/或接收媒体，其中每个帧表示一个内容单元。 音频的一秒可能以50帧的序列进行传输，每个帧包含20毫秒（ms）—一次语音内容的 1/50。 一秒的视频可能被作为30个静止图像的一个序列进行切片，每个视频在下一个视频帧显示前仅查看 33.3 ms （1/30 秒）。 每秒传输或呈现的帧数称为**帧速率**。 "30fps" 表示每秒30帧。

## <a name="audio-format"></a>音频格式

每秒两个音频表示为 16000**样本**，每个样本包含16位数据。 20毫秒音频帧包含320个样本（640个字节的数据）。

## <a name="video-format"></a>视频格式

视频支持几种格式。 视频格式的两个关键属性是其**帧大小**和**颜色格式**。 支持的帧大小包括640x360 （"360p"）、1280x720 （"720p"）和1920x1080 （"1080p"）。 支持的颜色格式包括 NV12 （12位/像素）和 RGB24 （24位/像素）。

"720p" 视频帧包含921600像素（1280乘以720）。 在 RGB24 颜色格式中，每个像素表示为3个字节（24位），每个红色、绿色和蓝色分量由一个字节组成。 因此，单个 720p RGB24 视频帧需要2764800字节的数据（921600像素乘以3字节/像素）。 如果帧速率为30fps，则发送 720p RGB24 视频帧意味着处理大约 80 MB/s 的内容（在网络传输之前，通过 H-p 视频编解码器对其进行了充分压缩）。

平台的高级功能允许 bot 以**编码**的 h-p 帧的形式发送/接收视频。 这支持提供其自己的 H-p 编码器/解码器的 bot，或者不需要将视频流解码为原始 RGB24 或 NV12 位图。

## <a name="active-and-dominant-speakers"></a>活动和主要扬声器

加入由多个参与者组成的团队会议时，bot 可以识别当前正在发言的会议参与者。 **主动扬声器**标识在每个收到的音频帧中听到的参与者。 **主要扬声器**标识在组对话中当前最活跃（或 "主要"）的参与者，即使在每个音频帧中听不到他们的语音也是如此。 在不同的参与者轮流发言的情况下，主要扬声器集可能会发生变化。

## <a name="video-subscription"></a>视频订阅

在1:1 呼叫中，如果启用了 bot 以接收视频，则 bot 将自动接收呼叫者的视频。 在团队会议中，bot 必须向要观看的参与者指示要查看的平台。 **视频订阅**是由 bot 接收参与者的主要视频或屏幕共享内容的请求。 当会议参与者召开对话时，自动程序可能会根据主要发言人集或通知（指示当前屏幕共享的参与者）的更新来修改所需的视频订阅。

## <a name="developer-resources"></a>开发人员资源

若要开发应用程序承载的媒体 bot，您必须在 Visual Studio 项目中安装以下 NuGet 包：

- [Microsoft. Media .NET 库](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/)

应用程序托管的媒体 bot 需要 .NET/c # 和 Windows Server，如[应用程序托管媒体 bot 的要求和注意事项](requirements-considerations-application-hosted-media-bots.md#application-hosted-media-bot-development-requires-cnet-and-windows-server)中所述。

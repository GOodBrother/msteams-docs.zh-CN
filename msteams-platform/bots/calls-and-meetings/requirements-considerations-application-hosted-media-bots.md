---
title: 应用程序托管媒体 bot 的要求和注意事项
description: 了解与为 Microsoft 团队创建应用程序托管媒体 bot 相关的重要要求和注意事项。
keywords: 应用程序承载的媒体 windows server azure 虚拟机
ms.date: 11/16/2018
ms.openlocfilehash: f5b721edacb11e867d05c8213b74036cb51f419c
ms.sourcegitcommit: fdcd91b270d4c2e98ab2b2c1029c76c49bb807fa
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/13/2020
ms.locfileid: "44801007"
---
# <a name="requirements-and-considerations-for-application-hosted-media-bots"></a><span data-ttu-id="b8859-104">应用程序托管媒体 bot 的要求和注意事项</span><span class="sxs-lookup"><span data-stu-id="b8859-104">Requirements and considerations for application-hosted media bots</span></span>

<span data-ttu-id="b8859-105">并非所有开发邮件和交互语音响应（IVR） bot 的指南都同样适用于生成应用程序托管的媒体 bot。</span><span class="sxs-lookup"><span data-stu-id="b8859-105">Not all guidance for developing messaging and Interactive Voice Response (IVR) bots applies equally to building application-hosted media bots.</span></span> <span data-ttu-id="b8859-106">本文介绍了开发和运行应用程序托管媒体 bot 的一些重要要求和注意事项。</span><span class="sxs-lookup"><span data-stu-id="b8859-106">This article describes some of the important requirements and considerations for developing and running an application-hosted media bot.</span></span>

> [!NOTE]
> <span data-ttu-id="b8859-107">由于用于 Bot 的 Microsoft 实时媒体平台是在开发人员预览版中，因此本文中的指导可能会发生变化。</span><span class="sxs-lookup"><span data-stu-id="b8859-107">Because the Microsoft Real-time Media Platform for Bots is in developer preview, the guidance in this article is subject to change.</span></span>

## <a name="application-hosted-media-bot-development-requires-cnet-and-windows-server"></a><span data-ttu-id="b8859-108">应用程序托管的媒体 bot 开发需要 c #/.NET 和 Windows Server</span><span class="sxs-lookup"><span data-stu-id="b8859-108">Application-hosted media bot development requires C#/.NET and Windows Server</span></span>

- <span data-ttu-id="b8859-109">应用程序托管的媒体 bot 需要 `Microsoft.Graph.Communications.Calls.Media` .net 库（[可在此处](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/)访问音频和视频媒体流，并且必须在 windows server 计算机（或 Azure 中的 WINDOWS server 来宾 OS）上部署 bot。</span><span class="sxs-lookup"><span data-stu-id="b8859-109">An application-hosted media bot requires the `Microsoft.Graph.Communications.Calls.Media` .NET library ([available here](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/) to access the audio and video media streams, and the bot must be deployed on a Windows Server machine (or Windows Server guest OS in Azure).</span></span> <span data-ttu-id="b8859-110">因此，必须在 c # 和 standard .NET Framework 中开发机器人并在 Microsoft Azure 中部署机器人。</span><span class="sxs-lookup"><span data-stu-id="b8859-110">Therefore, the bot must be developed in C# and the standard .NET Framework and deployed in Microsoft Azure.</span></span> <span data-ttu-id="b8859-111">不能使用 c + + 或 Node.js Api 访问实时媒体和 .NET Core 不支持应用程序托管的媒体 bot。</span><span class="sxs-lookup"><span data-stu-id="b8859-111">You can't use C++ or Node.js APIs to access real-time media and .NET Core is not supported for an application-hosted media bot.</span></span>

- <span data-ttu-id="b8859-112">可以在以下 Azure 服务环境之一中托管应用程序托管的媒体 bot：</span><span class="sxs-lookup"><span data-stu-id="b8859-112">An application-hosted media bot can be hosted within one of the following Azure service environments:</span></span>
  - <span data-ttu-id="b8859-113">云服务。</span><span class="sxs-lookup"><span data-stu-id="b8859-113">Cloud Service.</span></span>
  - <span data-ttu-id="b8859-114">具有虚拟机规模集的 Service Fabric （VMSS）。</span><span class="sxs-lookup"><span data-stu-id="b8859-114">Service Fabric with Virtual Machine Scale Sets (VMSS).</span></span>
  - <span data-ttu-id="b8859-115">基础结构即服务（IaaS）虚拟机（VM）。</span><span class="sxs-lookup"><span data-stu-id="b8859-115">Infrastructure as a Service (IaaS) Virtual Machine (VM).</span></span>  
  
- <span data-ttu-id="b8859-116">无法将应用程序托管的媒体 bot 部署为 Azure Web 应用。</span><span class="sxs-lookup"><span data-stu-id="b8859-116">An application-hosted media bot can't be deployed as an Azure Web App.</span></span>

- <span data-ttu-id="b8859-117">应用程序托管的媒体 bot 必须在 .Net 库的最新版本上运行 `Microsoft.Graph.Communications.Calls.Media` 。</span><span class="sxs-lookup"><span data-stu-id="b8859-117">An application-hosted media bot must be running on a recent version of the `Microsoft.Graph.Communications.Calls.Media` .NET library.</span></span> <span data-ttu-id="b8859-118">Bot 应使用最新可用版本的[NuGet 包](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/)，或使用的版本不超过三个月。</span><span class="sxs-lookup"><span data-stu-id="b8859-118">The bot should use either the newest available version of the [NuGet package](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/), or a version that is not more than three months old.</span></span> <span data-ttu-id="b8859-119">库的较旧版本将被弃用，并且在几个月后可能无法工作。</span><span class="sxs-lookup"><span data-stu-id="b8859-119">Older versions of the library will be deprecated and may not work after a few months.</span></span> <span data-ttu-id="b8859-120">`Microsoft.Graph.Communications.Calls.Media`将库保持最新可确保机器人和 Microsoft 团队之间的最佳互操作性。</span><span class="sxs-lookup"><span data-stu-id="b8859-120">Keeping the `Microsoft.Graph.Communications.Calls.Media` library up-to-date will ensure the best interoperability between the bot and Microsoft Teams.</span></span>

## <a name="real-time-media-calls-stay-on-the-machine-where-they-were-created"></a><span data-ttu-id="b8859-121">实时媒体呼叫停留在创建它们的计算机上</span><span class="sxs-lookup"><span data-stu-id="b8859-121">Real-time media calls stay on the machine where they were created</span></span>

- <span data-ttu-id="b8859-122">实时媒体呼叫将固定到已接受或已启动呼叫的虚拟机（VM）实例。</span><span class="sxs-lookup"><span data-stu-id="b8859-122">A real-time media call is pinned to the virtual machine (VM) instance that accepted or started the call.</span></span> <span data-ttu-id="b8859-123">来自 Microsoft 团队呼叫或会议的媒体将流向该 VM 实例，并且机器人发送回 Microsoft 团队的媒体也必须源自该 VM。</span><span class="sxs-lookup"><span data-stu-id="b8859-123">Media from a Microsoft Teams call or meeting will flow to that VM instance, and media the bot sends back to Microsoft Teams must also originate from that VM.</span></span>
- <span data-ttu-id="b8859-124">如果在停止 VM 时正在进行任何实时媒体呼叫，这些呼叫将突然终止。</span><span class="sxs-lookup"><span data-stu-id="b8859-124">If there are any real-time media calls in progress when the VM is stopped, those calls will be abruptly terminated.</span></span> <span data-ttu-id="b8859-125">如果 bot 事先了解挂起的 VM 关闭，它可能会尝试 "正常" 结束呼叫。</span><span class="sxs-lookup"><span data-stu-id="b8859-125">If the bot has prior knowledge of the pending VM shutdown, it can try to "gracefully" end the calls.</span></span>

## <a name="application-hosted-media-bots-must-be-directly-accessible-on-the-internet"></a><span data-ttu-id="b8859-126">应用程序托管的媒体 bot 必须可以直接在 internet 上进行访问</span><span class="sxs-lookup"><span data-stu-id="b8859-126">Application-hosted media bots must be directly accessible on the internet</span></span>

- <span data-ttu-id="b8859-127">在 Azure 中托管应用程序托管媒体 bot 的每个 VM 实例都必须使用实例级公共 IP 地址（ILPIP）直接从 internet 进行访问。</span><span class="sxs-lookup"><span data-stu-id="b8859-127">Each VM instance hosting an application-hosted media bot in Azure must be directly accessible from the internet using an instance-level public IP address (ILPIP).</span></span>
  - <span data-ttu-id="b8859-128">若要获取和配置 Azure 云服务的 ILPIP，请参阅[Instance level PUBLIC IP （经典）概述](/azure/virtual-network/virtual-networks-instance-level-public-ip)。</span><span class="sxs-lookup"><span data-stu-id="b8859-128">For obtaining and configuring an ILPIP for an Azure Cloud Service, see [Instance level public IP (Classic) overview](/azure/virtual-network/virtual-networks-instance-level-public-ip).</span></span>
  - <span data-ttu-id="b8859-129">若要为 VM 规模集配置 ILPIP，请参阅[Public IPv4 per virtual machine](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-networking#public-ipv4-per-virtual-machine)。</span><span class="sxs-lookup"><span data-stu-id="b8859-129">For configuring an ILPIP for a VM Scale Set, see [Public IPv4 per virtual machine](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-networking#public-ipv4-per-virtual-machine).</span></span>
- <span data-ttu-id="b8859-130">承载应用程序托管媒体 bot 的服务还必须使用映射到特定实例的面向公众的端口配置每个 VM 实例。</span><span class="sxs-lookup"><span data-stu-id="b8859-130">The service hosting an application-hosted media bot must also configure each VM instance with a public-facing port which maps to the specific instance.</span></span>
  - <span data-ttu-id="b8859-131">对于 Azure 云服务，这需要一个实例输入终结点;请参阅[在 Azure 中启用角色实例的通信](/azure/cloud-services/cloud-services-enable-communication-role-instances)。</span><span class="sxs-lookup"><span data-stu-id="b8859-131">For an Azure Cloud Service, this requires an instance input endpoint; see [Enable communication for role instances in Azure](/azure/cloud-services/cloud-services-enable-communication-role-instances).</span></span>
  - <span data-ttu-id="b8859-132">对于 VM 规模集，必须配置负载平衡器上的 NAT 规则;请参阅[Azure 中的虚拟网络和虚拟机](/azure/virtual-machines/windows/network-overview)。</span><span class="sxs-lookup"><span data-stu-id="b8859-132">For a VM Scale Set, a NAT rule on the load balancer must be configured; see [Virtual networks and virtual machines in Azure](/azure/virtual-machines/windows/network-overview).</span></span>
- <span data-ttu-id="b8859-133">Bot 框架仿真器不支持应用程序托管的媒体 bot。</span><span class="sxs-lookup"><span data-stu-id="b8859-133">Application-hosted media bots aren't supported by the Bot Framework Emulator.</span></span>

## <a name="scalability-and-performance-considerations"></a><span data-ttu-id="b8859-134">可伸缩性和性能注意事项</span><span class="sxs-lookup"><span data-stu-id="b8859-134">Scalability and performance considerations</span></span>

- <span data-ttu-id="b8859-135">应用程序托管的媒体 bot 需要比邮件机器人更多的计算和网络（带宽）容量，并且可能会产生显著更高的运营成本。</span><span class="sxs-lookup"><span data-stu-id="b8859-135">Application-hosted media bots require more compute and network (bandwidth) capacity than messaging bots and may incur significantly higher operational costs.</span></span> <span data-ttu-id="b8859-136">实时媒体机器人开发人员必须仔细衡量 bot 的可伸缩性，并确保 bot 不会接受比它更多的同时呼叫数。</span><span class="sxs-lookup"><span data-stu-id="b8859-136">A real-time media bot developer must carefully measure the bot's scalability, and ensure the bot doesn't accept more simultaneous calls than it can manage.</span></span> <span data-ttu-id="b8859-137">启用视频的 bot 可能只能承受每个 CPU 核心的一个或两个并发媒体会话（如果使用 "raw" RGB24 或 NV12 视频格式）。</span><span class="sxs-lookup"><span data-stu-id="b8859-137">A video-enabled bot may be able to sustain only one or two concurrent media sessions per CPU core (if using the "raw" RGB24 or NV12 video formats).</span></span>
- <span data-ttu-id="b8859-138">实时媒体平台目前不会利用 VM 上提供的任何图形处理单元（GPU）来脱离加载 H-p 视频编码/解码。</span><span class="sxs-lookup"><span data-stu-id="b8859-138">The Real-time Media Platform doesn't currently take advantage of any Graphics Processing Units (GPU) available on the VM to off-load H.264 video encoding/decoding.</span></span> <span data-ttu-id="b8859-139">相反，视频编码和解码是在 CPU 上的软件中完成的。</span><span class="sxs-lookup"><span data-stu-id="b8859-139">Instead, video encode and decode are done in software on the CPU.</span></span> <span data-ttu-id="b8859-140">如果有 GPU 可用，则 bot 可以利用它进行自己的图形呈现（例如，如果 bot 使用的是3D 图形引擎）。</span><span class="sxs-lookup"><span data-stu-id="b8859-140">If a GPU is available, the bot may take advantage of it for its own graphics rendering (e.g. if the bot is using a 3D graphics engine).</span></span>
- <span data-ttu-id="b8859-141">托管实时媒体 bot 的 VM 实例必须至少具有2个 CPU 内核。</span><span class="sxs-lookup"><span data-stu-id="b8859-141">The VM instance hosting the real-time media bot must have at least 2 CPU cores.</span></span> <span data-ttu-id="b8859-142">对于 Azure，建议使用 Dv2 系列虚拟机。</span><span class="sxs-lookup"><span data-stu-id="b8859-142">For Azure, a Dv2-series virtual machine is recommended.</span></span> <span data-ttu-id="b8859-143">对于其他 Azure VM 类型，具有4个虚拟 Cpu （vCPU）的系统是所需的最小大小。</span><span class="sxs-lookup"><span data-stu-id="b8859-143">For other Azure VM types, a system with 4 virtual CPUs (vCPU) is the minimum size required.</span></span> <span data-ttu-id="b8859-144">Azure[文档](/azure/virtual-machines/windows/sizes-general)中提供了有关 azure VM 类型的详细信息。</span><span class="sxs-lookup"><span data-stu-id="b8859-144">Detailed information about Azure VM types is available in the [Azure documentation](/azure/virtual-machines/windows/sizes-general).</span></span>

## <a name="samples-and-additional-resources"></a><span data-ttu-id="b8859-145">示例和其他资源</span><span class="sxs-lookup"><span data-stu-id="b8859-145">Samples and Additional Resources</span></span>

- [<span data-ttu-id="b8859-146">示例应用程序</span><span class="sxs-lookup"><span data-stu-id="b8859-146">Sample applications</span></span>](https://github.com/microsoftgraph/microsoft-graph-comms-samples/tree/master/Samples/V1.0Samples/LocalMediaSamples)
- [<span data-ttu-id="b8859-147">图调用 SDK 文档</span><span class="sxs-lookup"><span data-stu-id="b8859-147">Graph Calling SDK Documentation</span></span>](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/)

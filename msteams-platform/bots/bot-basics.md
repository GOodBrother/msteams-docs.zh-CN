---
title: 机器人基础知识
author: clearab
description: 了解团队中的 bot 的基础知识。
ms.topic: conceptual
ms.author: anclear
ms.openlocfilehash: e1b0c79b73ae89c8ab76ba0a1ff045603ab0b932
ms.sourcegitcommit: 4329a94918263c85d6c65ff401f571556b80307b
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/01/2020
ms.locfileid: "41673161"
---
# <a name="bot-basics"></a><span data-ttu-id="ae7ea-103">机器人基础知识</span><span class="sxs-lookup"><span data-stu-id="ae7ea-103">Bot basics</span></span>

<span data-ttu-id="ae7ea-104">这篇文章介绍了如何在核心[Bot 框架文档](https://aka.ms/azure-bot-service-docs)中[使用 bot 工作](https://aka.ms/how-bots-work)的文章。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-104">This is an introduction that builds on the article [How bots work](https://aka.ms/how-bots-work) in the core [Bot Framework documentation](https://aka.ms/azure-bot-service-docs).</span></span> <span data-ttu-id="ae7ea-105">您可能会发现，这篇文章以及*概念*部分中的其他文章非常有用。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-105">You may find that article, and the other articles in the *Concepts* section, useful.</span></span>

<span data-ttu-id="ae7ea-106">为 Microsoft 团队开发的 bot 的主要区别在于活动的处理方式。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-106">The primary difference in bots developed for Microsoft Teams is in how activities are handled.</span></span> <span data-ttu-id="ae7ea-107">Microsoft 团队活动处理程序从 Bot 框架的活动处理程序派生，以在允许处理任何非团队特定活动之前路由所有团队活动。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-107">The Microsoft Teams activity handler derives from the Bot Framework's activity handler to route all Teams activities before allowing any non-Teams specific activities to be handled.</span></span>

## <a name="teams-activity-handlers"></a><span data-ttu-id="ae7ea-108">团队活动处理程序</span><span class="sxs-lookup"><span data-stu-id="ae7ea-108">Teams Activity handlers</span></span>

<span data-ttu-id="ae7ea-109">当 Microsoft 团队的 bot 收到活动时，它会将其传递到其*活动处理程序*。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-109">When a bot for Microsoft Teams receives an activity, it passes it on to its *activity handlers*.</span></span> <span data-ttu-id="ae7ea-110">在封面下，有一个称为*turn 处理程序*的基本处理程序，所有活动都通过路由。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-110">Under the covers, there's one base handler called the *turn handler*, that all activities are routed through.</span></span> <span data-ttu-id="ae7ea-111">*Turn 处理程序*将调用所需的活动处理程序以处理收到的任何类型的活动。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-111">The *turn handler* calls the required activity handler to handle whatever type of activity was received.</span></span> <span data-ttu-id="ae7ea-112">为 Microsoft 团队设计的 bot 的不同之处在于，它是`TeamsActivityHandler`从来自 bot 框架的`ActivityHandler`类派生的类派生而来。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-112">Where a bot designed for Microsoft Teams differs is that it is derived from `TeamsActivityHandler` class that is derived from the Bot Framework's `ActivityHandler` class.</span></span>

# <a name="ctabcsharp"></a>[<span data-ttu-id="ae7ea-113">C#</span><span class="sxs-lookup"><span data-stu-id="ae7ea-113">C#</span></span>](#tab/csharp)

<span data-ttu-id="ae7ea-114">与使用 Microsoft Bot 框架创建的任何 bot 一样，如果 bot 收到一条消息活动，则 turn 处理程序会看到传入的活动并将其`OnMessageActivityAsync`发送到活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-114">As with any bot created using the Microsoft Bot Framework, if the bot receives a message activity, the turn handler sees that incoming activity and sends it to the `OnMessageActivityAsync` activity handler.</span></span> <span data-ttu-id="ae7ea-115">在团队中，此功能保持不变。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-115">In Teams, this functionality remains the same.</span></span> <span data-ttu-id="ae7ea-116">如果 bot 收到对话更新活动，则 turn 处理程序会发现传入的活动并将其发送到`OnConversationUpdateActivityAsync` *团队*活动处理程序，该处理程序将首先检查任何团队特定事件，如果没有找到，则将其传递给 bot 框架的活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-116">If the bot receives a conversation update activity, the turn handler sees that incoming activity and sends it to the `OnConversationUpdateActivityAsync` *Teams* activity handler that will first check for any Teams specific events and pass it along to the Bot Framework's activity handler if none are found.</span></span>

<span data-ttu-id="ae7ea-117">在团队活动处理程序类中，有两个主要的团队活动`OnConversationUpdateActivityAsync`处理程序，它们路由所有对话更新`OnInvokeActivityAsync`活动，并路由所有团队调用活动。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-117">In the Teams activity handler class, there are two primary Teams activity handlers, `OnConversationUpdateActivityAsync` that routes all conversation update activities, and `OnInvokeActivityAsync` that routes all Teams invoke activities.</span></span>

<span data-ttu-id="ae7ea-118">若要为工作组特定的活动处理程序实现您的逻辑，您将在您的 bot 中覆盖这些方法，如下面的[bot 逻辑](#bot-logic)部分中所示。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-118">To implement your logic for Teams specific activity handlers, you'll override these methods in your bot as shown in the [Bot logic](#bot-logic) section below.</span></span> <span data-ttu-id="ae7ea-119">对于上述每个处理程序，都没有基实现，因此只需在替代中添加所需的逻辑即可。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-119">For each of these handlers, there is no base implementation, so just add the logic that you want in your override.</span></span>

# <a name="javascripttabjavascript"></a>[<span data-ttu-id="ae7ea-120">JavaScript</span><span class="sxs-lookup"><span data-stu-id="ae7ea-120">JavaScript</span></span>](#tab/javascript)

<span data-ttu-id="ae7ea-121">与使用 Microsoft Bot 框架创建的任何 bot 一样，如果 bot 收到一条消息活动，则 turn 处理程序会看到传入的活动并将其`onMessage`发送到活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-121">As with any bot created using the Microsoft Bot Framework, if the bot receives a message activity, the turn handler sees that incoming activity and sends it to the `onMessage` activity handler.</span></span> <span data-ttu-id="ae7ea-122">在团队中，此功能保持不变。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-122">In Teams, this functionality remains the same.</span></span> <span data-ttu-id="ae7ea-123">如果 bot 收到对话更新活动，则 turn 处理程序将看到传入的活动并将其发送到`dispatchConversationUpdateActivity` *团队*活动处理程序，该处理程序将首先检查是否有任何工作组特定事件，如果未找到，则将其传递给 bot 框架活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-123">If the bot receives a conversation update activity, the turn handler sees that incoming activity and sends it to the `dispatchConversationUpdateActivity` *Teams* activity handler that will first check for any Teams specific events and pass it along to the bot frameworks activity handler if none are found.</span></span>

<span data-ttu-id="ae7ea-124">在团队活动处理程序类中，有两个主要的团队活动`dispatchConversationUpdateActivity`处理程序，它们路由所有对话更新`onInvokeActivity`活动，并路由所有团队调用活动。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-124">In the Teams activity handler class, there are two primary Teams activity handlers, `dispatchConversationUpdateActivity` that routes all conversation update Activities, and `onInvokeActivity` that routes all Teams invoke activities.</span></span>

<span data-ttu-id="ae7ea-125">若要为工作组特定的活动处理程序实现你的逻辑，你将在你的 bot 中覆盖这些方法，如下面的[bot 逻辑](#bot-logic)部分中所示。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-125">To implement your logic for Teams specific activity handlers, you'll override these methods in your bot as seen in the [Bot logic](#bot-logic) section below.</span></span> <span data-ttu-id="ae7ea-126">对于每个处理程序，定义您的 bot 逻辑，然后**务必在结尾`next()`处呼叫**。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-126">For each of these handlers, define your bot logic, then **be sure to call `next()` at the end**.</span></span> <span data-ttu-id="ae7ea-127">通过调用`next()` ，可以确保下一个处理程序运行。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-127">By calling `next()` you ensure that the next handler runs.</span></span>

---

## <a name="bot-logic"></a><span data-ttu-id="ae7ea-128">Bot 逻辑</span><span class="sxs-lookup"><span data-stu-id="ae7ea-128">Bot logic</span></span>

<span data-ttu-id="ae7ea-129">Bot 逻辑处理来自一个或多个机器人频道的传入活动并生成响应中的传出活动。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-129">The bot logic processes incoming activities from one or more of your bot channels and generates outgoing activities in response.</span></span>  <span data-ttu-id="ae7ea-130">这仍适用于从团队活动处理程序类派生的 bot，它首先检查团队活动，然后将所有其他活动传递到 bot 框架活动处理程序。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-130">This is still true of bots derived from the Teams activity handler class, which first checks for Teams activities, then passes all other activities to the bot frameworks activity handler.</span></span>

# <a name="ctabcsharp"></a>[<span data-ttu-id="ae7ea-131">C#</span><span class="sxs-lookup"><span data-stu-id="ae7ea-131">C#</span></span>](#tab/csharp)

#### <a name="core-bot-framework-handlers"></a><span data-ttu-id="ae7ea-132">核心 Bot 框架处理程序</span><span class="sxs-lookup"><span data-stu-id="ae7ea-132">Core Bot Framework handlers</span></span>

<span data-ttu-id="ae7ea-133">以下所述的所有活动处理程序将继续工作，就像处理*添加*的成员和*删除*了活动的成员例外，在团队的上下文中，将新成员添加到团队中，而不是将新成员添加到团队中，而非邮件线程。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-133">All of the activity handlers described below will continue to work as they do with a non-Teams bot, with the exception of handling members *added* and members *removed* activities, these will be different in the context of a team, where the new member is added to the team as opposed to a message thread.</span></span>

<span data-ttu-id="ae7ea-134">中`ActivityHandler`定义的处理程序如下所示。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-134">The handlers defined in `ActivityHandler` are outlined below.</span></span>

| <span data-ttu-id="ae7ea-135">事件</span><span class="sxs-lookup"><span data-stu-id="ae7ea-135">Event</span></span> | <span data-ttu-id="ae7ea-136">Handler</span><span class="sxs-lookup"><span data-stu-id="ae7ea-136">Handler</span></span> | <span data-ttu-id="ae7ea-137">说明</span><span class="sxs-lookup"><span data-stu-id="ae7ea-137">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="ae7ea-138">收到的任何活动类型</span><span class="sxs-lookup"><span data-stu-id="ae7ea-138">Any activity type received</span></span> | `OnTurnAsync` | <span data-ttu-id="ae7ea-139">根据收到的活动类型调用其他处理程序之一。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-139">Calls one of the other handlers, based on the type of activity received.</span></span> |
| <span data-ttu-id="ae7ea-140">接收的邮件活动</span><span class="sxs-lookup"><span data-stu-id="ae7ea-140">Message activity received</span></span> | `OnMessageActivityAsync` | <span data-ttu-id="ae7ea-141">重写此参数以`Message`处理活动。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-141">Override this to handle a `Message` activity.</span></span> |
| <span data-ttu-id="ae7ea-142">收到对话更新活动</span><span class="sxs-lookup"><span data-stu-id="ae7ea-142">Conversation update activity received</span></span> | `OnConversationUpdateActivityAsync` | <span data-ttu-id="ae7ea-143">在`ConversationUpdate`活动中，如果加入或离开对话之外的其他成员，则调用处理程序。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-143">On a `ConversationUpdate` activity, calls a handler if members other than the bot joined or left the conversation.</span></span> |
| <span data-ttu-id="ae7ea-144">加入对话的非 bot 成员</span><span class="sxs-lookup"><span data-stu-id="ae7ea-144">Non-bot members joined the conversation</span></span> | `OnMembersAddedAsync` | <span data-ttu-id="ae7ea-145">重写此参数以处理加入对话的成员。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-145">Override this to handle members joining a conversation.</span></span> |
| <span data-ttu-id="ae7ea-146">非机器人成员离开对话</span><span class="sxs-lookup"><span data-stu-id="ae7ea-146">Non-bot members left the conversation</span></span> | `OnMembersRemovedAsync` | <span data-ttu-id="ae7ea-147">重写此参数可处理离开对话的成员。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-147">Override this to handle members leaving a conversation.</span></span> |
| <span data-ttu-id="ae7ea-148">接收的事件活动</span><span class="sxs-lookup"><span data-stu-id="ae7ea-148">Event activity received</span></span> | `OnEventActivityAsync` | <span data-ttu-id="ae7ea-149">在`Event`活动中，调用特定于事件类型的处理程序。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-149">On an `Event` activity, calls a handler specific to the event type.</span></span> |
| <span data-ttu-id="ae7ea-150">接收的令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="ae7ea-150">Token-response event activity received</span></span> | `OnTokenResponseEventAsync` | <span data-ttu-id="ae7ea-151">重写此参数以处理令牌响应事件。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-151">Override this to handle token response events.</span></span> |
| <span data-ttu-id="ae7ea-152">收到的非令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="ae7ea-152">Non-token-response event activity received</span></span> | `OnEventAsync` | <span data-ttu-id="ae7ea-153">重写此参数可处理其他类型的事件。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-153">Override this to handle other types of events.</span></span> |
| <span data-ttu-id="ae7ea-154">收到的其他活动类型</span><span class="sxs-lookup"><span data-stu-id="ae7ea-154">Other activity type received</span></span> | `OnUnrecognizedActivityTypeAsync` | <span data-ttu-id="ae7ea-155">重写此参数以处理未处理的任何活动类型。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-155">Override this to handle any activity type otherwise unhandled.</span></span> |

#### <a name="teams-specific-handlers"></a><span data-ttu-id="ae7ea-156">特定于团队的处理程序</span><span class="sxs-lookup"><span data-stu-id="ae7ea-156">Teams-specific handlers</span></span>

<span data-ttu-id="ae7ea-157">`TeamsActivityHandler`扩展了上面的处理程序列表，以包含以下内容：</span><span class="sxs-lookup"><span data-stu-id="ae7ea-157">The `TeamsActivityHandler` extends the list of handlers above to include the following:</span></span>

| <span data-ttu-id="ae7ea-158">事件</span><span class="sxs-lookup"><span data-stu-id="ae7ea-158">Event</span></span> | <span data-ttu-id="ae7ea-159">Handler</span><span class="sxs-lookup"><span data-stu-id="ae7ea-159">Handler</span></span> | <span data-ttu-id="ae7ea-160">说明</span><span class="sxs-lookup"><span data-stu-id="ae7ea-160">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="ae7ea-161">channelCreated</span><span class="sxs-lookup"><span data-stu-id="ae7ea-161">channelCreated</span></span> | `OnTeamsChannelCreatedAsync` | <span data-ttu-id="ae7ea-162">重写此参数以处理正在创建的团队频道。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-162">Override this to handle a Teams channel being created.</span></span> <span data-ttu-id="ae7ea-163">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events)中[创建的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created)。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-163">For more information see [Channel created](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="ae7ea-164">channelDeleted</span><span class="sxs-lookup"><span data-stu-id="ae7ea-164">channelDeleted</span></span> | `OnTeamsChannelDeletedAsync` | <span data-ttu-id="ae7ea-165">重写此参数可处理要删除的团队频道。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-165">Override this to handle a Teams channel being deleted.</span></span> <span data-ttu-id="ae7ea-166">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events)中[删除的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted)。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-166">For more information see [Channel deleted](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="ae7ea-167">channelRenamed</span><span class="sxs-lookup"><span data-stu-id="ae7ea-167">channelRenamed</span></span> | `OnTeamsChannelRenamedAsync` | <span data-ttu-id="ae7ea-168">重写此参数可处理要重命名的团队频道。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-168">Override this to handle a Teams channel being renamed.</span></span> <span data-ttu-id="ae7ea-169">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events)中[重命名的通道](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed)。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-169">For more information see [Channel renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="ae7ea-170">teamRenamed</span><span class="sxs-lookup"><span data-stu-id="ae7ea-170">teamRenamed</span></span> | `OnTeamsTeamRenamedAsync` | <span data-ttu-id="ae7ea-171">`return Task.CompletedTask;`重写此参数可处理要重命名的团队团队。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-171">`return Task.CompletedTask;` Override this to handle a Teams Team being Renamed.</span></span> <span data-ttu-id="ae7ea-172">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events)中[重命名的团队](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed)。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-172">For more information see [Team renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="ae7ea-173">MembersAdded</span><span class="sxs-lookup"><span data-stu-id="ae7ea-173">MembersAdded</span></span> | `OnTeamsMembersAddedAsync` | <span data-ttu-id="ae7ea-174">调用中`OnMembersAddedAsync` `ActivityHandler`的方法。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-174">Calls the `OnMembersAddedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="ae7ea-175">重写此参数以处理加入团队的成员。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-175">Override this to handle members joining a team.</span></span> <span data-ttu-id="ae7ea-176">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events)中[添加的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events#Team-Member-Added)。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-176">For more information see [Team member added](https://aka.ms/azure-bot-subscribe-to-conversation-events#Team-Member-Added) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="ae7ea-177">MembersRemoved</span><span class="sxs-lookup"><span data-stu-id="ae7ea-177">MembersRemoved</span></span> | `OnTeamsMembersRemovedAsync` | <span data-ttu-id="ae7ea-178">调用中`OnMembersRemovedAsync` `ActivityHandler`的方法。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-178">Calls the `OnMembersRemovedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="ae7ea-179">重写此参数可处理离开团队的成员。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-179">Override this to handle members leaving a team.</span></span> <span data-ttu-id="ae7ea-180">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events)中[删除了工作组成员](https://aka.ms/azure-bot-subscribe-to-conversation-events#Team-Member-Removed)。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-180">For more information see [Team member removed](https://aka.ms/azure-bot-subscribe-to-conversation-events#Team-Member-Removed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|

#### <a name="teams-invoke--activities"></a><span data-ttu-id="ae7ea-181">团队调用活动</span><span class="sxs-lookup"><span data-stu-id="ae7ea-181">Teams invoke  activities</span></span>

<span data-ttu-id="ae7ea-182">下面列出了从`OnInvokeActivityAsync` _团队_活动处理程序中调用的所有团队活动处理程序：</span><span class="sxs-lookup"><span data-stu-id="ae7ea-182">Here is a list of all of the Teams activity handlers called from the `OnInvokeActivityAsync` _Teams_ activity handler:</span></span>

| <span data-ttu-id="ae7ea-183">调用类型</span><span class="sxs-lookup"><span data-stu-id="ae7ea-183">Invoke types</span></span>                    | <span data-ttu-id="ae7ea-184">Handler</span><span class="sxs-lookup"><span data-stu-id="ae7ea-184">Handler</span></span>                              | <span data-ttu-id="ae7ea-185">说明</span><span class="sxs-lookup"><span data-stu-id="ae7ea-185">Description</span></span>                                                  |
| :-----------------------------  | :----------------------------------- | :----------------------------------------------------------- |
| <span data-ttu-id="ae7ea-186">CardAction</span><span class="sxs-lookup"><span data-stu-id="ae7ea-186">CardAction.Invoke</span></span>               | `OnTeamsCardActionInvokeAsync`       | <span data-ttu-id="ae7ea-187">团队卡片操作调用。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-187">Teams Card Action Invoke.</span></span> |
| <span data-ttu-id="ae7ea-188">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="ae7ea-188">fileConsent/invoke</span></span>              | `OnTeamsFileConsentAcceptAsync`      | <span data-ttu-id="ae7ea-189">团队文件同意接受。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-189">Teams File Consent Accept.</span></span> |
| <span data-ttu-id="ae7ea-190">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="ae7ea-190">fileConsent/invoke</span></span>              | `OnTeamsFileConsentAsync`            | <span data-ttu-id="ae7ea-191">团队文件许可。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-191">Teams File Consent.</span></span> |
| <span data-ttu-id="ae7ea-192">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="ae7ea-192">fileConsent/invoke</span></span>              | `OnTeamsFileConsentDeclineAsync`     | <span data-ttu-id="ae7ea-193">团队文件许可。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-193">Teams File Consent.</span></span> |
| <span data-ttu-id="ae7ea-194">actionableMessage/executeAction</span><span class="sxs-lookup"><span data-stu-id="ae7ea-194">actionableMessage/executeAction</span></span> | `OnTeamsO365ConnectorCardActionAsync` | <span data-ttu-id="ae7ea-195">团队 O365 连接器卡片操作。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-195">Teams O365 Connector Card Action.</span></span> |
| <span data-ttu-id="ae7ea-196">登录/verifyState</span><span class="sxs-lookup"><span data-stu-id="ae7ea-196">signin/verifyState</span></span>              | `OnTeamsSigninVerifyStateAsync`      | <span data-ttu-id="ae7ea-197">团队登录验证状态。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-197">Teams Sign in Verify State.</span></span> |
| <span data-ttu-id="ae7ea-198">任务/提取</span><span class="sxs-lookup"><span data-stu-id="ae7ea-198">task/fetch</span></span>                      | `OnTeamsTaskModuleFetchAsync`        | <span data-ttu-id="ae7ea-199">团队任务模块提取。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-199">Teams Task Module Fetch.</span></span> |
| <span data-ttu-id="ae7ea-200">任务/提交</span><span class="sxs-lookup"><span data-stu-id="ae7ea-200">task/submit</span></span>                     | `OnTeamsTaskModuleSubmitAsync`       | <span data-ttu-id="ae7ea-201">团队任务模块提交。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-201">Teams Task Module Submit.</span></span> |

<span data-ttu-id="ae7ea-202">上面列出的调用活动适用于团队中的对话 bot。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-202">The invoke activities listed above are for conversational bots in Teams.</span></span> <span data-ttu-id="ae7ea-203">Bot 框架 SDK 还支持特定于邮件扩展的调用。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-203">The Bot Framework SDK also supports invokes specific to messaging extensions.</span></span> <span data-ttu-id="ae7ea-204">有关详细信息，请参阅[什么是邮件扩展](https://aka.ms/azure-bot-what-are-messaging-extensions)</span><span class="sxs-lookup"><span data-stu-id="ae7ea-204">For more information see [What are messaging extensions](https://aka.ms/azure-bot-what-are-messaging-extensions)</span></span>

# <a name="javascripttabjavascript"></a>[<span data-ttu-id="ae7ea-205">JavaScript</span><span class="sxs-lookup"><span data-stu-id="ae7ea-205">JavaScript</span></span>](#tab/javascript)

<span data-ttu-id="ae7ea-206">以下所述的所有活动处理程序将继续工作，如同处理*添加*的成员和*删除*了成员的活动除外，它们在团队的上下文中是不同的，在这种情况下，新成员将添加到团队中，而不是将新成员添加到团队中，而非邮件线程。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-206">All of the activity handlers described below will continue to work as they do with a non-Teams bot, with the exception of handling the members *added* and members *removed* activities, these will be different in the context of a team, where the new member is added to the team as opposed to a message thread.</span></span>

#### <a name="core-bot-framework-handlers"></a><span data-ttu-id="ae7ea-207">核心 Bot 框架处理程序</span><span class="sxs-lookup"><span data-stu-id="ae7ea-207">Core Bot Framework handlers</span></span>

<span data-ttu-id="ae7ea-208">中`ActivityHandler`定义的处理程序如下所示。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-208">The handlers defined in `ActivityHandler` are outlined below.</span></span>

| <span data-ttu-id="ae7ea-209">事件</span><span class="sxs-lookup"><span data-stu-id="ae7ea-209">Event</span></span> | <span data-ttu-id="ae7ea-210">Handler</span><span class="sxs-lookup"><span data-stu-id="ae7ea-210">Handler</span></span> | <span data-ttu-id="ae7ea-211">说明</span><span class="sxs-lookup"><span data-stu-id="ae7ea-211">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="ae7ea-212">收到的任何活动类型</span><span class="sxs-lookup"><span data-stu-id="ae7ea-212">Any activity type received</span></span> | `onTurn` | <span data-ttu-id="ae7ea-213">根据收到的活动类型调用其他处理程序之一。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-213">Calls one of the other handlers, based on the type of activity received.</span></span> |
| <span data-ttu-id="ae7ea-214">接收的邮件活动</span><span class="sxs-lookup"><span data-stu-id="ae7ea-214">Message activity received</span></span> | `onMessage` | <span data-ttu-id="ae7ea-215">为此提供用于处理`Message`活动的函数。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-215">Provide a function for this to handle a `Message` activity.</span></span> |
| <span data-ttu-id="ae7ea-216">收到对话更新活动</span><span class="sxs-lookup"><span data-stu-id="ae7ea-216">Conversation update activity received</span></span> | `onConversationUpdate` | <span data-ttu-id="ae7ea-217">在`ConversationUpdate`活动中，如果加入或离开对话之外的其他成员，则调用处理程序。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-217">On a `ConversationUpdate` activity, calls a handler if members other than the bot joined or left the conversation.</span></span> |
| <span data-ttu-id="ae7ea-218">加入对话的非 bot 成员</span><span class="sxs-lookup"><span data-stu-id="ae7ea-218">Non-bot members joined the conversation</span></span> | `onMembersAdded` | <span data-ttu-id="ae7ea-219">为此提供一个函数来处理加入对话的成员。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-219">Provide a function for this to handle members joining a conversation.</span></span> |
| <span data-ttu-id="ae7ea-220">非机器人成员离开对话</span><span class="sxs-lookup"><span data-stu-id="ae7ea-220">Non-bot members left the conversation</span></span> | `onMembersRemoved` | <span data-ttu-id="ae7ea-221">为此提供一个函数来处理离开对话的成员。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-221">Provide a function for this to handle members leaving a conversation.</span></span> |
| <span data-ttu-id="ae7ea-222">接收的事件活动</span><span class="sxs-lookup"><span data-stu-id="ae7ea-222">Event activity received</span></span> | `onEvent` | <span data-ttu-id="ae7ea-223">在`Event`活动中，调用特定于事件类型的处理程序。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-223">On an `Event` activity, calls a handler specific to the event type.</span></span> |
| <span data-ttu-id="ae7ea-224">接收的令牌响应事件活动</span><span class="sxs-lookup"><span data-stu-id="ae7ea-224">Token-response event activity received</span></span> | `onTokenResponseEvent` | <span data-ttu-id="ae7ea-225">为此提供用于处理令牌响应事件的函数。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-225">Provide a function for this to handle token response events.</span></span> |
| <span data-ttu-id="ae7ea-226">收到的其他活动类型</span><span class="sxs-lookup"><span data-stu-id="ae7ea-226">Other activity type received</span></span> | `onUnrecognizedActivityType` | <span data-ttu-id="ae7ea-227">为此提供一个函数以处理任何未处理的活动类型。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-227">Provide a function for this to handle any activity type otherwise unhandled.</span></span> |
| <span data-ttu-id="ae7ea-228">活动处理程序已完成</span><span class="sxs-lookup"><span data-stu-id="ae7ea-228">Activity handlers have completed</span></span> | `onDialog` | <span data-ttu-id="ae7ea-229">为此提供了一个函数，用于处理在结束时应完成的任何处理，在其余的活动处理程序完成之后。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-229">Provide a function for this to handle any processing that should be done at the end of a turn, after the rest of your activity handlers have completed.</span></span> |

#### <a name="teams-specific-handlers"></a><span data-ttu-id="ae7ea-230">特定于团队的处理程序</span><span class="sxs-lookup"><span data-stu-id="ae7ea-230">Teams-specific handlers</span></span>

<span data-ttu-id="ae7ea-231">`TeamsActivityHandler`扩展了上面的处理程序列表，以包含以下内容：</span><span class="sxs-lookup"><span data-stu-id="ae7ea-231">The `TeamsActivityHandler` extends the list of handlers above to include the following:</span></span>

| <span data-ttu-id="ae7ea-232">事件</span><span class="sxs-lookup"><span data-stu-id="ae7ea-232">Event</span></span> | <span data-ttu-id="ae7ea-233">Handler</span><span class="sxs-lookup"><span data-stu-id="ae7ea-233">Handler</span></span> | <span data-ttu-id="ae7ea-234">说明</span><span class="sxs-lookup"><span data-stu-id="ae7ea-234">Description</span></span> |
| :-- | :-- | :-- |
| <span data-ttu-id="ae7ea-235">channelCreated</span><span class="sxs-lookup"><span data-stu-id="ae7ea-235">channelCreated</span></span> | `OnTeamsChannelCreatedAsync` | <span data-ttu-id="ae7ea-236">重写此参数以处理正在创建的团队频道。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-236">Override this to handle a Teams channel being created.</span></span> <span data-ttu-id="ae7ea-237">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events)中[创建的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created)。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-237">For more information see [Channel created](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-created) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="ae7ea-238">channelDeleted</span><span class="sxs-lookup"><span data-stu-id="ae7ea-238">channelDeleted</span></span> | `OnTeamsChannelDeletedAsync` | <span data-ttu-id="ae7ea-239">重写此参数可处理要删除的团队频道。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-239">Override this to handle a Teams channel being deleted.</span></span> <span data-ttu-id="ae7ea-240">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events)中[删除的频道](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted)。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-240">For more information see [Channel deleted](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-deleted) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span>|
| <span data-ttu-id="ae7ea-241">channelRenamed</span><span class="sxs-lookup"><span data-stu-id="ae7ea-241">channelRenamed</span></span> | `OnTeamsChannelRenamedAsync` | <span data-ttu-id="ae7ea-242">重写此参数可处理要重命名的团队频道。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-242">Override this to handle a Teams channel being renamed.</span></span> <span data-ttu-id="ae7ea-243">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events)中[重命名的通道](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed)。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-243">For more information see [Channel renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#channel-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="ae7ea-244">teamRenamed</span><span class="sxs-lookup"><span data-stu-id="ae7ea-244">teamRenamed</span></span> | `OnTeamsTeamRenamedAsync` | <span data-ttu-id="ae7ea-245">`return Task.CompletedTask;`重写此参数可处理要重命名的团队团队。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-245">`return Task.CompletedTask;` Override this to handle a Teams Team being Renamed.</span></span> <span data-ttu-id="ae7ea-246">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events)中[重命名的团队](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed)。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-246">For more information see [Team renamed](https://aka.ms/azure-bot-subscribe-to-conversation-events#team-renamed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="ae7ea-247">MembersAdded</span><span class="sxs-lookup"><span data-stu-id="ae7ea-247">MembersAdded</span></span> | `OnTeamsMembersAddedAsync` | <span data-ttu-id="ae7ea-248">调用中`OnMembersAddedAsync` `ActivityHandler`的方法。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-248">Calls the `OnMembersAddedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="ae7ea-249">重写此参数以处理加入团队的成员。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-249">Override this to handle members joining a team.</span></span> <span data-ttu-id="ae7ea-250">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events)中[添加的团队成员](https://aka.ms/azure-bot-subscribe-to-conversation-events#Team-Member-Added)。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-250">For more information see [Team member added](https://aka.ms/azure-bot-subscribe-to-conversation-events#Team-Member-Added) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |
| <span data-ttu-id="ae7ea-251">MembersRemoved</span><span class="sxs-lookup"><span data-stu-id="ae7ea-251">MembersRemoved</span></span> | `OnTeamsMembersRemovedAsync` | <span data-ttu-id="ae7ea-252">调用中`OnMembersRemovedAsync` `ActivityHandler`的方法。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-252">Calls the `OnMembersRemovedAsync` method in `ActivityHandler`.</span></span> <span data-ttu-id="ae7ea-253">重写此参数可处理离开团队的成员。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-253">Override this to handle members leaving a team.</span></span> <span data-ttu-id="ae7ea-254">有关详细信息，请参阅在[对话更新事件](https://aka.ms/azure-bot-subscribe-to-conversation-events)中[删除了工作组成员](https://aka.ms/azure-bot-subscribe-to-conversation-events#Team-Member-Removed)。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-254">For more information see [Team member removed](https://aka.ms/azure-bot-subscribe-to-conversation-events#Team-Member-Removed) in [Conversation update events](https://aka.ms/azure-bot-subscribe-to-conversation-events).</span></span> |

#### <a name="teams-invoke-activities"></a><span data-ttu-id="ae7ea-255">团队调用活动</span><span class="sxs-lookup"><span data-stu-id="ae7ea-255">Teams invoke activities</span></span>

<span data-ttu-id="ae7ea-256">下面列出了从`onInvokeActivity` _团队_活动处理程序中调用的所有团队活动处理程序：</span><span class="sxs-lookup"><span data-stu-id="ae7ea-256">Here is a list of all of the Teams activity handlers called from the `onInvokeActivity` _Teams_ activity handler:</span></span>

| <span data-ttu-id="ae7ea-257">调用类型</span><span class="sxs-lookup"><span data-stu-id="ae7ea-257">Invoke types</span></span>                    | <span data-ttu-id="ae7ea-258">Handler</span><span class="sxs-lookup"><span data-stu-id="ae7ea-258">Handler</span></span>                              | <span data-ttu-id="ae7ea-259">说明</span><span class="sxs-lookup"><span data-stu-id="ae7ea-259">Description</span></span>                                                  |
| :-----------------------------  | :----------------------------------- | :----------------------------------------------------------- |
| <span data-ttu-id="ae7ea-260">CardAction</span><span class="sxs-lookup"><span data-stu-id="ae7ea-260">CardAction.Invoke</span></span>               | `handleTeamsCardActionInvoke`       | <span data-ttu-id="ae7ea-261">团队卡片操作调用。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-261">Teams Card Action Invoke.</span></span> |
| <span data-ttu-id="ae7ea-262">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="ae7ea-262">fileConsent/invoke</span></span>              | `handleTeamsFileConsentAccept`      | <span data-ttu-id="ae7ea-263">团队文件同意接受。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-263">Teams File Consent Accept.</span></span> |
| <span data-ttu-id="ae7ea-264">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="ae7ea-264">fileConsent/invoke</span></span>              | `handleTeamsFileConsent`            | <span data-ttu-id="ae7ea-265">团队文件许可。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-265">Teams File Consent.</span></span> |
| <span data-ttu-id="ae7ea-266">fileConsent/invoke</span><span class="sxs-lookup"><span data-stu-id="ae7ea-266">fileConsent/invoke</span></span>              | `handleTeamsFileConsentDecline`     | <span data-ttu-id="ae7ea-267">团队文件许可。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-267">Teams File Consent.</span></span> |
| <span data-ttu-id="ae7ea-268">actionableMessage/executeAction</span><span class="sxs-lookup"><span data-stu-id="ae7ea-268">actionableMessage/executeAction</span></span> | `handleTeamsO365ConnectorCardAction` | <span data-ttu-id="ae7ea-269">团队 O365 连接器卡片操作。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-269">Teams O365 Connector Card Action.</span></span> |
| <span data-ttu-id="ae7ea-270">登录/verifyState</span><span class="sxs-lookup"><span data-stu-id="ae7ea-270">signin/verifyState</span></span>              | `handleTeamsSigninVerifyState`      | <span data-ttu-id="ae7ea-271">团队登录验证状态。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-271">Teams Sign in Verify State.</span></span> |
| <span data-ttu-id="ae7ea-272">任务/提取</span><span class="sxs-lookup"><span data-stu-id="ae7ea-272">task/fetch</span></span>                      | `handleTeamsTaskModuleFetch`        | <span data-ttu-id="ae7ea-273">团队任务模块提取。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-273">Teams Task Module Fetch.</span></span> |
| <span data-ttu-id="ae7ea-274">任务/提交</span><span class="sxs-lookup"><span data-stu-id="ae7ea-274">task/submit</span></span>                     | `handleTeamsTaskModuleSubmit`       | <span data-ttu-id="ae7ea-275">团队任务模块提交。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-275">Teams Task Module Submit.</span></span> |

<span data-ttu-id="ae7ea-276">上面列出的调用活动适用于团队中的对话 bot。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-276">The invoke activities listed above are for conversational bots in Teams.</span></span> <span data-ttu-id="ae7ea-277">Bot 框架 SDK 还支持特定于邮件扩展的调用。</span><span class="sxs-lookup"><span data-stu-id="ae7ea-277">The Bot Framework SDK also supports invocations specific to messaging extensions.</span></span> <span data-ttu-id="ae7ea-278">有关详细信息，请参阅[什么是邮件扩展](https://aka.ms/azure-bot-what-are-messaging-extensions)</span><span class="sxs-lookup"><span data-stu-id="ae7ea-278">For more information see [What are messaging extensions](https://aka.ms/azure-bot-what-are-messaging-extensions)</span></span>

---

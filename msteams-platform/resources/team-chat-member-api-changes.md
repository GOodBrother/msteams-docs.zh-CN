---
title: 团队/聊天成员 (2020 更新) 的 Bot API 更改
author: ojasvichoudhary
description: 介绍用于检索团队和聊天成员的 Bot Api 的即将进行和正在进行的更改
keywords: bot 框架 api 团队成员名单
ms.topic: reference
ms.author: ojchoudh
ms.openlocfilehash: 243969796d9d1dc427ab7736cf5e0f0d320731c7
ms.sourcegitcommit: 3fc7ad33e2693f07170c3cb1a0d396261fc5c619
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/29/2020
ms.locfileid: "48796139"
---
# <a name="changes-to-teams-bot-apis-for-fetching-teamchat-members"></a><span data-ttu-id="08993-104">对用于提取团队/聊天成员的团队 Bot Api 的更改</span><span class="sxs-lookup"><span data-stu-id="08993-104">Changes to Teams Bot APIs for Fetching Team/Chat Members</span></span>

<span data-ttu-id="08993-105">目前，要检索聊天或团队的一个或多个成员的信息的 bot 开发人员使用 Microsoft 团队 bot Api `TeamsInfo.GetMembersAsync` (For c # ) 或 `TeamsInfo.getMembers` (的 TypeScript/Node.js) api ([ 在此处) 记录 ](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetching-the-roster-or-user-profile)。</span><span class="sxs-lookup"><span data-stu-id="08993-105">Currently, bot developers who want to retrieve information for one or more members of a chat or team use the Microsoft Teams bot APIs `TeamsInfo.GetMembersAsync` (for C#) or `TeamsInfo.getMembers` (for TypeScript/Node.js) APIs [(documented here)](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetching-the-roster-or-user-profile).</span></span> <span data-ttu-id="08993-106">这些 Api 目前有几项缺点：</span><span class="sxs-lookup"><span data-stu-id="08993-106">These APIs have several shortcomings today:</span></span>

* <span data-ttu-id="08993-107">**对于大型团队，性能较差且超时更有可能。**</span><span class="sxs-lookup"><span data-stu-id="08993-107">**For large teams, performance is poor and timeouts are more likely.**</span></span> <span data-ttu-id="08993-108">由于 Microsoft 团队在早期2017发布，因此团队的最大大小已大大增加。</span><span class="sxs-lookup"><span data-stu-id="08993-108">The maximum team size has grown considerably since Microsoft Teams was released in early 2017.</span></span> <span data-ttu-id="08993-109">由于 `GetMembersAsync` / `getMembers` 返回整个成员列表，API 调用为大型团队返回的时间较长，因此调用超时并不常见，您必须重试。</span><span class="sxs-lookup"><span data-stu-id="08993-109">Since `GetMembersAsync`/`getMembers` returns the entire member list, it takes a long time for the API call to return for large teams, and it’s not uncommon for the call to time out and you have to try again.</span></span>
* <span data-ttu-id="08993-110">**获取单个用户的配置文件详细信息非常麻烦。**</span><span class="sxs-lookup"><span data-stu-id="08993-110">**Getting profile details for a single user is cumbersome.**</span></span> <span data-ttu-id="08993-111">若要获取单个用户的配置文件信息，您必须检索整个成员列表，然后搜索所需的成员列表。</span><span class="sxs-lookup"><span data-stu-id="08993-111">To get the profile information for a single user, you have to retrieve the entire member list and then search for the one you want.</span></span> <span data-ttu-id="08993-112">True，在 Bot 框架 SDK 中有一个 helper 函数可使其更简单，但在覆盖它的效率不高的情况下。</span><span class="sxs-lookup"><span data-stu-id="08993-112">True, there’s a helper function in the Bot Framework SDK to make it simpler, but under the covers it’s not efficient.</span></span>

<span data-ttu-id="08993-113">此外，随着组织范围内的团队的推出，我们已意识到，可以更好地将这些 Api 与 Office 365 隐私控件对齐：大型团队中使用的 bot 能够检索基本配置文件信息，这与 `User.ReadBasic.All` Microsoft Graph 权限类似。</span><span class="sxs-lookup"><span data-stu-id="08993-113">Separately, with the introduction of org-wide teams, we realized it was time to better align these APIs with Office 365 privacy controls: bots used in large teams are able to retrieve basic profile information, which is similar to the `User.ReadBasic.All` Microsoft Graph permission.</span></span> <span data-ttu-id="08993-114">租户管理员可以很好地控制可在其租户中使用的应用程序和 bot，但这些设置不同于控制 Microsoft Graph 的用户。</span><span class="sxs-lookup"><span data-stu-id="08993-114">Tenant administrators have a great deal of control over which apps and bots can be used in their tenant, but these settings are different than the ones governing Microsoft Graph.</span></span>

<span data-ttu-id="08993-115">下面是这些 Api 的当前返回内容的示例 JSON 表示形式。</span><span class="sxs-lookup"><span data-stu-id="08993-115">Here’s a sample JSON representation of what’s returned by these APIs today.</span></span> <span data-ttu-id="08993-116">我将参考下面的一些字段。</span><span class="sxs-lookup"><span data-stu-id="08993-116">I’ll refer to some of the fields below.</span></span>

```json
[{
    "id": "29:1GcS4EyB_oSI8A88XmWBN7NJFyMqe3QGnJdgLfFGkJnVelzRGos0bPbpsfJjcbAD22bmKc4GMbrY2g4JDrrA8vM06X1-cHHle4zOE6U4ttcc",
    "name": "Anon1 (Guest)",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "anonymous"
}, {
    "id": "29:1bSnHZ7Js2STWrgk6ScEErLk1Lp2zQuD5H2qQ960rtvstKp8tKLl-3r8b6DoW0QxZimuTxk_kupZ1DBMpvIQQUAZL-PNj0EORDvRZXy8kvWk",
    "objectId": "76b0b09f-d410-48fd-993e-84da521a597b",
    "givenName": "John",
    "surname": "Patterson",
    "email": "johnp@fabrikam.com",
    "userPrincipalName": "johnp@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}, {
    "id": "29:1URzNQM1x1PNMr1D7L5_lFe6qF6gEfAbkdG8_BUxOW2mTKryQqEZtBTqDt10-MghkzjYDuUj4KG6nvg5lFAyjOLiGJ4jzhb99WrnI7XKriCs",
    "objectId": "6b7b3b2a-2c4b-4175-8582-41c9e685c1b5",
    "givenName": "Rick",
    "surname": "Stevens",
    "email": "Rick.Stevens@fabrikam.com",
    "userPrincipalName": "rstevens@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}]
```

## <a name="api-changes"></a><span data-ttu-id="08993-117">API 更改</span><span class="sxs-lookup"><span data-stu-id="08993-117">API Changes</span></span>
<span data-ttu-id="08993-118">以下是即将发布的 API 更改：</span><span class="sxs-lookup"><span data-stu-id="08993-118">Here are the upcoming API changes:</span></span>

* <span data-ttu-id="08993-119">我们创建了一个新的 API [`TeamsInfo.GetPagedMembersAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetching-the-roster-or-user-profile) ，用于检索聊天/团队成员的配置文件信息。</span><span class="sxs-lookup"><span data-stu-id="08993-119">We've created a new API [`TeamsInfo.GetPagedMembersAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetching-the-roster-or-user-profile) for retrieving profile information for members of a chat/team.</span></span> <span data-ttu-id="08993-120">此 API 现在可在 Bot 框架 4.8 SDK 中使用。</span><span class="sxs-lookup"><span data-stu-id="08993-120">This API is now available with the Bot Framework 4.8 SDK.</span></span> <span data-ttu-id="08993-121">若要在所有其他版本中进行开发，请使用 [`GetConversationPagedMembers`](https://docs.microsoft.com/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable) 方法。</span><span class="sxs-lookup"><span data-stu-id="08993-121">For development in all other versions use the [`GetConversationPagedMembers`](https://docs.microsoft.com/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable) method.</span></span> <span data-ttu-id="08993-122">**注意** ：在 v3 或 v4 中，最佳操作是分别升级到最新的点 (3.30.2 或 4.8) 。</span><span class="sxs-lookup"><span data-stu-id="08993-122">**Note** : In either v3 or v4, the best action is to upgrade to the latest point release (3.30.2 or 4.8 respectively).</span></span> 
* <span data-ttu-id="08993-123">我们创建了一个新的 API [`TeamsInfo.GetMemberAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#get-single-member-details) ，用于检索单个用户的配置文件信息。</span><span class="sxs-lookup"><span data-stu-id="08993-123">We've created a new API [`TeamsInfo.GetMemberAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#get-single-member-details) for retrieving the profile information for a single user.</span></span> <span data-ttu-id="08993-124">它采用团队/聊天和 [UPN](https://docs.microsoft.com/windows/win32/ad/naming-properties#userprincipalname) (的 ID `userPrincipalName` ， *请参阅以上* ) 的 Azure Active Directory 对象 ID (`objectId` ， *参阅以上* ) 或团队用户 ID (`id` ，请 *参阅以上* ) 作为参数，并返回该用户的配置文件信息。</span><span class="sxs-lookup"><span data-stu-id="08993-124">It takes the ID of the team/chat and a [UPN](https://docs.microsoft.com/windows/win32/ad/naming-properties#userprincipalname) (`userPrincipalName`, *see above* ), Azure Active Directory Object ID (`objectId`, *see above* ), or the Teams user ID (`id`, *see above* ) as parameters and returns the profile information for that user.</span></span> <span data-ttu-id="08993-125">**注意** ：我们正在将更改 `objectId` 为， `aadObjectId` 以匹配在 `Activity` Bot 框架消息的对象中调用的内容。</span><span class="sxs-lookup"><span data-stu-id="08993-125">**Note** : We're changing `objectId` to `aadObjectId` to match what it's called in the `Activity` object of a Bot Framework message.</span></span> <span data-ttu-id="08993-126">在 Bot 框架 SDK 的4.8 版中提供了新的 API。</span><span class="sxs-lookup"><span data-stu-id="08993-126">The new API is available with version 4.8 of the Bot Framework SDK.</span></span> <span data-ttu-id="08993-127">此外，还将在团队 SDK 扩展 Bot Framework 3 中提供此功能。同时，您可以使用 [REST](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#get-single-member-details) 终结点。</span><span class="sxs-lookup"><span data-stu-id="08993-127">It will soon be available in the Teams SDK extension Bot Framework 3.x as well; meanwhile you can use the [REST](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#get-single-member-details) endpoint.</span></span>
* <span data-ttu-id="08993-128">`TeamsInfo.GetMembersAsync` (c # ) 和 `TeamsInfo.getMembers` (TypeScript/Node.js) 已正式弃用，并将在后期2021中停止工作。</span><span class="sxs-lookup"><span data-stu-id="08993-128">`TeamsInfo.GetMembersAsync` (C#) and `TeamsInfo.getMembers` (TypeScript/Node.js) is formally deprecated and will stop working in late 2021.</span></span> <span data-ttu-id="08993-129">我们将根据开发人员的反馈，在5月2020日宣布特定的时间表。</span><span class="sxs-lookup"><span data-stu-id="08993-129">We'll announce a specific timetable in May 2020, based on feedback from developers.</span></span> <span data-ttu-id="08993-130">一旦新的页面调度 API 可用，开发人员就应更新其机器人以使用它。</span><span class="sxs-lookup"><span data-stu-id="08993-130">Once the new paged API is available, developers should update their bots to use it.</span></span> <span data-ttu-id="08993-131"> (这也适用于 [这些 api 使用的基础 REST API](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#tabpanel_CeZOj-G++Q_json)。 ) </span><span class="sxs-lookup"><span data-stu-id="08993-131">(This also applies to the [underlying REST API these APIs use](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#tabpanel_CeZOj-G++Q_json).)</span></span>
* <span data-ttu-id="08993-132">通过后期2021，bot 将无法主动检索 `userPrincipalName` `email` 聊天/团队成员的或属性，并且需要使用 Microsoft Graph 来检索它们。</span><span class="sxs-lookup"><span data-stu-id="08993-132">By late 2021, bots will not be able to proactively retrieve the `userPrincipalName` or `email` properties for members of a chat/team and will need to use Microsoft Graph to retrieve them.</span></span> <span data-ttu-id="08993-133">具体说来， `userPrincipalName` `email` 不会从晚2021开始的新 API 中返回属性 `GetConversationPagedMembers` 。</span><span class="sxs-lookup"><span data-stu-id="08993-133">Specifically, `userPrincipalName` and `email` properties won't be returned from the new `GetConversationPagedMembers` API starting in late 2021.</span></span> <span data-ttu-id="08993-134">Bot 必须使用具有访问令牌的 Microsoft Graph 来检索此信息。</span><span class="sxs-lookup"><span data-stu-id="08993-134">Bots will have to use Microsoft Graph with an access token to retrieve this information.</span></span> <span data-ttu-id="08993-135">这显然是一项重大更改：我们必须让 bot 更轻松地获取访问令牌，并且我们必须优化和简化最终用户同意过程。</span><span class="sxs-lookup"><span data-stu-id="08993-135">This is obviously a major change: We must make it easier for bots to get an access token, and we must streamline and simplify the end-user consent process.</span></span>

## <a name="feedback-and-more-information"></a><span data-ttu-id="08993-136">反馈和详细信息</span><span class="sxs-lookup"><span data-stu-id="08993-136">Feedback and More Information</span></span>
<span data-ttu-id="08993-137">我们将使用此页面提供有关这些更改的最新信息。</span><span class="sxs-lookup"><span data-stu-id="08993-137">We'll use this page for providing up to date information on these changes.</span></span> <span data-ttu-id="08993-138">如果有问题，请使用下面 " **反馈** " 部分中的 "发送反馈 > 此页面"。</span><span class="sxs-lookup"><span data-stu-id="08993-138">If you have questions, use the "Send feedback > on this page" in the **Feedback** section below.</span></span> 
